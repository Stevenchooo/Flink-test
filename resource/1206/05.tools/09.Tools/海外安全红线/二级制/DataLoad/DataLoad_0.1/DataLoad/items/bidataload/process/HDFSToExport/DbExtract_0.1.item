<?xml version="1.0" encoding="UTF-8"?>
<talendfile:ProcessType xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:talendfile="platform:/resource/org.talend.model/model/TalendFile.xsd" defaultContext="Default">
  <context confirmationNeeded="false" name="Default">
    <contextParameter comment="" name="destDB" prompt="destDB?" promptNeeded="false" type="id_Object" value=""/>
    <contextParameter comment="" name="hdfsToDB" prompt="hdfsToDB?" promptNeeded="false" type="id_Object" value=""/>
    <contextParameter comment="" name="commondInfo" prompt="commondInfo?" promptNeeded="false" type="id_Object" value=""/>
    <contextParameter comment="" name="sourceDB" prompt="sourceDB?" promptNeeded="false" type="id_Object" value=""/>
    <contextParameter comment="" name="actionFlag" prompt="actionFlag?" promptNeeded="false" type="id_Integer" value=""/>
  </context>
  <parameters>
    <elementParameter field="TEXT" name="JOB_RUN_VM_ARGUMENTS" value=" -Xms256M -Xmx1024M"/>
    <elementParameter field="CHECK" name="JOB_RUN_VM_ARGUMENTS_OPTION" value="true"/>
    <elementParameter field="TEXT" name="SCREEN_OFFSET_X" value="0"/>
    <elementParameter field="TEXT" name="SCREEN_OFFSET_Y" value="0"/>
    <elementParameter field="TEXT" name="SCHEMA_OPTIONS" value="none"/>
    <elementParameter field="TEXT" name="OEM_CUSTOM_ATTRIBUTE" value=""/>
    <elementParameter field="TEXT" name="HADOOP_APP_PATH" value=""/>
    <elementParameter field="TEXT" name="JOBID_FOR_OOZIE" value=""/>
    <elementParameter field="CHECK" name="IMPLICITCONTEXT_USE_PROJECT_SETTINGS" value="true"/>
    <elementParameter field="CHECK" name="STATANDLOG_USE_PROJECT_SETTINGS" value="true"/>
    <elementParameter field="FILE" name="IMPLICIT_TCONTEXTLOAD_FILE" value="&quot;&quot;"/>
    <elementParameter field="TEXT" name="FIELDSEPARATOR" value="&quot;&quot;"/>
    <elementParameter field="CLOSED_LIST" name="DB_VERSION_IMPLICIT_CONTEXT" value=""/>
    <elementParameter field="CLOSED_LIST" name="LOAD_NEW_VARIABLE" value=""/>
    <elementParameter field="CLOSED_LIST" name="NOT_LOAD_OLD_VARIABLE" value=""/>
    <elementParameter field="CHECK" name="DISABLE_WARNINGS" value="false"/>
    <elementParameter field="CHECK" name="DISABLE_INFO" value="false"/>
    <elementParameter field="TECHNICAL" name="ENCODING:ENCODING_TYPE" value="ISO-8859-15"/>
    <elementParameter field="CLOSED_LIST" name="DB_VERSION" value="ORACLE_10"/>
    <routinesParameter id="_j81p4AKEEeSeuZe1VRqQ1w" name="DataOperation"/>
    <routinesParameter id="_j9lQwAKEEeSeuZe1VRqQ1w" name="Mathematical"/>
    <routinesParameter id="_j9ntAAKEEeSeuZe1VRqQ1w" name="Numeric"/>
    <routinesParameter id="_j9o7IAKEEeSeuZe1VRqQ1w" name="Relational"/>
    <routinesParameter id="_j9qwUAKEEeSeuZe1VRqQ1w" name="StringHandling"/>
    <routinesParameter id="_j9slgAKEEeSeuZe1VRqQ1w" name="TalendDataGenerator"/>
    <routinesParameter id="_j9tzoAKEEeSeuZe1VRqQ1w" name="TalendDate"/>
    <routinesParameter id="_j9vo0AKEEeSeuZe1VRqQ1w" name="TalendString"/>
  </parameters>
  <node componentName="tHiveConnection" componentVersion="0.102" offsetLabelX="0" offsetLabelY="0" posX="320" posY="160">
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="tHiveConnection_1"/>
    <elementParameter field="CLOSED_LIST" name="HIVE_VERSION" value="APACHE_0_20_203"/>
    <elementParameter field="CLOSED_LIST" name="CONNECTION_MODE" value="STANDALONE"/>
    <elementParameter field="TEXT" name="HOST" value="((DBConfiguration)context.sourceDB).getHost()"/>
    <elementParameter field="TEXT" name="TYPE" value="Hive"/>
    <elementParameter field="TEXT" name="PORT" value="((DBConfiguration)context.sourceDB).getPort()"/>
    <elementParameter field="TEXT" name="DBNAME" value="&quot;&quot;"/>
    <elementParameter field="TEXT" name="USER" value="((DBConfiguration)context.sourceDB).getUserName()"/>
    <elementParameter field="PASSWORD" name="PASS" value="JbuQQGD8Uhxn84ImpRiaawN6Ink3IJaG/xBxT8/wMAW96q+PNC/x5xFFuWeeLhaxf4ZV4a5uKsw="/>
    <elementParameter field="CHECK" name="SET_MAPRED_JT" value="false"/>
    <elementParameter field="TEXT" name="MAPRED_JT" value="&quot;localhost:50300&quot;"/>
    <elementParameter field="CHECK" name="SET_FS_DEFAULT_NAME" value="false"/>
    <elementParameter field="TEXT" name="FS_DEFAULT_NAME" value="&quot;hdfs://localhost:8020&quot;"/>
    <elementParameter field="ENCODING_TYPE" name="ENCODING" value="&quot;UTF-8&quot;"/>
    <elementParameter field="TECHNICAL" name="ENCODING:ENCODING_TYPE" value="UTF-8"/>
    <elementParameter field="CHECK" name="USE_SHARED_CONNECTION" value="false"/>
    <elementParameter field="TEXT" name="SHARED_CONNECTION_NAME" value=""/>
    <elementParameter field="TABLE" name="HADOOP_ADVANCED_PROPERTIES"/>
    <elementParameter field="TEXT" name="CONNECTION_FORMAT" value="row"/>
    <elementParameter field="CHECK" name="INFORMATION" value="false"/>
    <elementParameter field="MEMO" name="COMMENT" value=""/>
    <elementParameter field="CHECK" name="VALIDATION_RULES" value="false"/>
    <elementParameter field="CLOSED_LIST" name="DISTRIBUTION" value="APACHE"/>
  </node>
  <node componentName="tJava" componentVersion="0.101" offsetLabelX="0" offsetLabelY="0" posX="512" posY="160">
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="tJava_2"/>
    <elementParameter field="MEMO_JAVA" name="CODE" value="Logger logger = Logger.getLogger(jobName);&#xA;globalMap.put(&quot;logger&quot;, logger);&#xA;&#xA;ExportJobContext jobContext = new ExportJobContext();&#xA;jobContext.setConn((Connection)globalMap.get(&quot;conn_tHiveConnection_1&quot;));&#xA;&#xA;HDFSInfo hdfsInfo = (HDFSInfo)context.hdfsToDB;&#xA;&#xA;logger.info(&quot;DestDBInfo:&quot;);&#xA;logger.info(&quot;extractSql=&quot; + hdfsInfo.getExtractSql());&#xA;logger.info(&quot;partition=&quot; + hdfsInfo.getPartition());&#xA;logger.info(&quot;sourceDB=&quot; + hdfsInfo.getSourceDB());&#xA;logger.info(&quot;tablename=&quot; + hdfsInfo.getTablename());&#xA;&#xA;if (hdfsInfo instanceof HDFSToDBInfo) {&#xA;    logger.info(&quot;destDB=&quot; + ((HDFSToDBInfo)hdfsInfo).getDestDB());&#xA;    logger.info(&quot;aliasTablename=&quot; + ((HDFSToDBInfo)hdfsInfo).getAliasTablename());&#xA;    logger.info(&quot;maxErrorNumber=&quot; + ((HDFSToDBInfo)hdfsInfo).getMaxErrorNumber());&#xA;}&#xA;if (hdfsInfo instanceof HDFSToFileInfo) {&#xA;    logger.info(&quot;destFilePath=&quot; + ((HDFSToFileInfo)hdfsInfo).getDestFilePath());&#xA;    logger.info(&quot;separator=&quot; + ((HDFSToFileInfo)hdfsInfo).getSeparator());&#xA;    logger.info(&quot;aliasFilename=&quot; + ((HDFSToFileInfo)hdfsInfo).getAliasFilename());&#xA;}&#xA;&#xA;Configuration dbConfiguration = null;&#xA;String toolName = null;&#xA;if (context.actionFlag == 2) {&#xA;&#x9;toolName = &quot;exporttodb&quot;;&#xA;&#x9;dbConfiguration = (DBConfiguration)context.destDB; &#xA;&#x9;((DBConfiguration)dbConfiguration).setMaxErrorNumber(((HDFSToDBInfo)context.hdfsToDB).getMaxErrorNumber());&#xA;&#x9;((DBConfiguration)dbConfiguration).setMaxPercentNumber(((HDFSToDBInfo)context.hdfsToDB).getMaxPercentNumber());&#xA;&#x9;&#xA;&#x9;logger.info(&quot;DestDBInfo:&quot;);&#xA;&#x9;logger.info(&quot;type=&quot; + ((DBConfiguration)(dbConfiguration)).getType());&#xA;&#x9;logger.info(&quot;host=&quot; + ((DBConfiguration)(dbConfiguration)).getHost());&#xA;&#x9;logger.info(&quot;port=&quot; + ((DBConfiguration)(dbConfiguration)).getPort());&#xA;&#x9;logger.info(&quot;dbName=&quot; + ((DBConfiguration)(dbConfiguration)).getDbName());&#xA;&#x9;logger.info(&quot;userName=&quot; + ((DBConfiguration)(dbConfiguration)).getUserName());&#xA;&#x9;logger.info(&quot;password=******&quot;);&#xA;&#x9;logger.info(&quot;additionalParams=&quot; + ((DBConfiguration)(dbConfiguration)).getAdditionalParams());&#xA;&#x9;logger.info(&quot;maxErrorNumber=&quot; + ((DBConfiguration)(dbConfiguration)).getMaxErrorNumber());&#xA;&#x9;logger.info(&quot;maxPercentNumber=&quot; + ((DBConfiguration)(dbConfiguration)).getMaxPercentNumber());&#xA;}&#xA;else if (context.actionFlag == 3) {&#xA;&#x9;toolName = &quot;exporttofile&quot;;&#xA;&#x9;HDFSToFileInfo hdfsToFileInfo = (HDFSToFileInfo)hdfsInfo; &#xA;&#x9;FileConfiguration fileConfiguration = new FileConfiguration();&#xA;&#x9;&#xA;&#x9;String filename = DataloadStringUtils.replaceEnvionment(hdfsToFileInfo.getAliasFilename(), (CommondInfo)context.commondInfo);&#xA;&#x9;&#xA;&#x9;fileConfiguration.setFilename(filename);&#xA;&#x9;fileConfiguration.setSeparator(hdfsToFileInfo.getSeparator());&#xA;&#x9;fileConfiguration.setFilePath(hdfsToFileInfo.getDestFilePath());&#xA;&#x9;dbConfiguration = fileConfiguration;&#xA;&#x9;&#xA;&#x9;logger.info(&quot;FileConfiguration:&quot;);&#xA;&#x9;logger.info(&quot;filename=&quot; + fileConfiguration.getFilename());&#xA;&#x9;logger.info(&quot;filePath=&quot; + fileConfiguration.getFilePath());&#xA;&#x9;logger.info(&quot;separator=&quot; + fileConfiguration.getSeparator());&#xA;&#x9;logger.info(&quot;columnNames=&quot; + fileConfiguration.getColumnNames());&#xA;}&#xA;&#xA;jobContext.setHdfsInfo(hdfsInfo);&#xA;jobContext.setDbConfig(dbConfiguration);&#xA;jobContext.setCommondInfo((CommondInfo)context.commondInfo);&#xA;&#x9;&#x9;&#xA;DataloadExplain tool = DataloadExplain.getTool(toolName);&#xA;int returnCode = tool.start(jobContext);&#xA;if (returnCode != ReturnCode.ERRORCODE_SUCCESS) {&#xA;&#x9;throw new ExportException(returnCode, &quot;Encountered IOException running export job.&quot;);&#xA;}&#xA;else {&#xA;&#x9;logger.info(&quot;Export datas from Hive successfully.&quot;);&#xA;}&#xA;&#xA;&#xA;"/>
    <elementParameter field="MEMO_IMPORT" name="IMPORT" value="import java.sql.Connection;&#xA;import java.text.ParseException;&#xA;&#xA;import com.huawei.etl.dataload.util.ExportException;&#xA;import com.huawei.etl.dataload.util.ExportException.ReturnCode;&#xA;import com.huawei.etl.dataload.conf.AppConfReader;&#xA;import com.huawei.etl.dataload.conf.CommondInfo;&#xA;import com.huawei.etl.dataload.conf.Configuration;&#xA;import com.huawei.etl.dataload.conf.DBConfiguration;&#xA;import com.huawei.etl.dataload.conf.EnvFileReader;&#xA;import com.huawei.etl.dataload.conf.HDFSToDBInfo;&#xA;import com.huawei.etl.dataload.explain.DataloadExplain;&#xA;import com.huawei.etl.dataload.export.ExportJobContext;&#xA;import com.huawei.etl.dataload.conf.FileConfInfo;&#xA;import com.huawei.etl.dataload.conf.HDFSInfo;&#xA;import com.huawei.etl.dataload.conf.FileToHDFSInfo;&#xA;import com.huawei.etl.dataload.conf.FileConfiguration;&#xA;import com.huawei.etl.dataload.conf.FileToHDFSInfo;&#xA;import com.huawei.etl.dataload.conf.HDFSToFileInfo;&#xA;import com.huawei.etl.dataload.conf.HDFSToDBInfo;&#xA;import com.huawei.etl.dataload.util.DataloadStringUtils;&#xA;&#xA;"/>
    <elementParameter field="TEXT" name="CONNECTION_FORMAT" value="row"/>
    <elementParameter field="CHECK" name="INFORMATION" value="false"/>
    <elementParameter field="MEMO" name="COMMENT" value=""/>
    <elementParameter field="CHECK" name="VALIDATION_RULES" value="false"/>
    <metadata connector="FLOW" name="tJava_2"/>
  </node>
  <node componentName="tJava" componentVersion="0.101" offsetLabelX="0" offsetLabelY="0" posX="128" posY="160">
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="tJava_1"/>
    <elementParameter field="CHECK" name="START" value="true"/>
    <elementParameter field="MEMO_JAVA" name="CODE" value="Logger logger = Logger.getLogger(jobName);&#xA;globalMap.put(&quot;logger&quot;, logger);&#xA;&#xA;logger.info(&quot;Export datas from Hive ...&quot;);&#xA;&#xA;logger.info(&quot;SourceDBInfo:&quot;);&#xA;logger.info(&quot;type=&quot; + ((DBConfiguration)(context.sourceDB)).getType());&#xA;logger.info(&quot;host=&quot; + ((DBConfiguration)(context.sourceDB)).getHost());&#xA;logger.info(&quot;port=&quot; + ((DBConfiguration)(context.sourceDB)).getPort());&#xA;logger.info(&quot;dbName=&quot; + ((DBConfiguration)(context.sourceDB)).getDbName());&#xA;logger.info(&quot;userName=&quot; + ((DBConfiguration)(context.sourceDB)).getUserName());&#xA;logger.info(&quot;password=******&quot;);&#xA;logger.info(&quot;additionalParams=&quot; + ((DBConfiguration)(context.sourceDB)).getAdditionalParams());"/>
    <elementParameter field="MEMO_IMPORT" name="IMPORT" value="import org.apache.log4j.Logger;&#xA;&#xA;import com.huawei.etl.dataload.conf.DBConfiguration;"/>
    <elementParameter field="TEXT" name="CONNECTION_FORMAT" value="row"/>
    <elementParameter field="CHECK" name="INFORMATION" value="false"/>
    <elementParameter field="MEMO" name="COMMENT" value=""/>
    <elementParameter field="CHECK" name="VALIDATION_RULES" value="false"/>
    <metadata connector="FLOW" name="tJava_1"/>
  </node>
  <connection connectorName="SUBJOB_OK" label="OnSubjobOk" lineStyle="1" metaname="tHiveConnection_1" offsetLabelX="0" offsetLabelY="0" source="tHiveConnection_1" target="tJava_2">
    <elementParameter field="CHECK" name="ACTIVATE" value="true"/>
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="OnSubjobOk2"/>
  </connection>
  <connection connectorName="SUBJOB_OK" label="OnSubjobOk" lineStyle="1" metaname="tJava_1" offsetLabelX="0" offsetLabelY="0" source="tJava_1" target="tHiveConnection_1">
    <elementParameter field="CHECK" name="ACTIVATE" value="true"/>
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="OnSubjobOk1"/>
  </connection>
  <subjob>
    <elementParameter field="CHECK" name="SHOW_SUBJOB_TITLE" value="true"/>
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="tHiveConnection_1"/>
    <elementParameter field="TEXT" name="SUBJOB_TITLE" value="hive 连接"/>
    <elementParameter field="COLOR" name="SUBJOB_TITLE_COLOR" value="160;190;240"/>
    <elementParameter field="COLOR" name="SUBJOB_COLOR" value="220;220;250"/>
  </subjob>
  <subjob>
    <elementParameter field="CHECK" name="SHOW_SUBJOB_TITLE" value="true"/>
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="tJava_2"/>
    <elementParameter field="TEXT" name="SUBJOB_TITLE" value="入库准备"/>
    <elementParameter field="COLOR" name="SUBJOB_TITLE_COLOR" value="160;190;240"/>
    <elementParameter field="COLOR" name="SUBJOB_COLOR" value="220;220;250"/>
  </subjob>
  <subjob>
    <elementParameter field="CHECK" name="SHOW_SUBJOB_TITLE" value="true"/>
    <elementParameter field="TEXT" name="UNIQUE_NAME" value="tJava_1"/>
    <elementParameter field="TEXT" name="SUBJOB_TITLE" value="数据抽取开始"/>
    <elementParameter field="COLOR" name="SUBJOB_TITLE_COLOR" value="160;190;240"/>
    <elementParameter field="COLOR" name="SUBJOB_COLOR" value="220;220;250"/>
  </subjob>
</talendfile:ProcessType>
