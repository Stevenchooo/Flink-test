<reportIndexGroup>
    <multiHqlReportIndexs>
	<!--
	*********************************************************************************************
	//订购话单
	//分时段（00~23H）订购人数
	//
	//结算数据情况：
	projectid@110#dtime@20170510#
	projectid@110#activitychannelid@119#dtime@20170510#
	*********************************************************************************************
	-->
        <!--  每天每时段 观看用户数 dayorderproduct -->
        <multiHqlReportIndex>
            <indexKey>video.users.hours.action.orderproduct.h</indexKey>
            <fieldName>dayorderproduct</fieldName>
            <hql>
                <![CDATA[
				select projectid,activitychannelid,contentid,htime,
					   count(distinct(tt.identityid)) dayorderproduct
				  from (select t.projectid,
							   if(t.activitychannelid is null,'none',t.activitychannelid) activitychannelid,
							   'ALL' contentid,
							   substr(t.time,0,10) htime,
							   t.identityid
						  from video.t_cdr_top_order_info t
						 where t.date > substr('{STARTTIME}',0,8)
						   and t.date < substr('{ENDTIME}',0,8)
						   and (t.actiontype = 1 OR t.actiontype = 3)
					union all
						select t.projectid,
							   'ALL' activitychannelid,
							   'ALL' contentid,
							   substr(t.time,0,10) htime,
							   t.identityid
						  from video.t_cdr_top_order_info t
						 where t.date > substr('{STARTTIME}',0,8)
						   and t.date < substr('{ENDTIME}',0,8)
						   and (t.actiontype = 1 OR t.actiontype = 3)
					)tt
				group by projectid,activitychannelid,contentid,htime
                ]]>
            </hql>
        </multiHqlReportIndex>
	<!--
	*********************************************************************************************
	//HVS话单
	//分时段（00~23H）观看人数
	//
	//结算数据情况：
	VOD
	projectid@110#dtime@20170510#
	projectid@110#activitychannelid@119#dtime@20170510#
	LiveTV
	projectid@110#contentid@120#dtime@20170510#
	projectid@110#activitychannelid@119#contentid@120#dtime@20170510#
	*********************************************************************************************
	-->
        <!--  每天每时段 观看用户数 hourswatch -->
        <multiHqlReportIndex>
            <indexKey>video.users.hours.action.hvswatch.h</indexKey>
            <fieldName>hoursltvwatch,hoursvodwatch</fieldName>
            <hql>
                <![CDATA[
				select projectid,activitychannelid,contentid,
					   concat(dtime,hourstime) htime ,
					   hoursltvwatch,hoursvodwatch
				from ( select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '00' hourstime,
							  if(h00ltvwatch is null,0,h00ltvwatch) hoursltvwatch,
							  if(h00vodwatch is null,0,h00vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '01' hourstime,
							  if(h01ltvwatch is null,0,h01ltvwatch) hoursltvwatch,
							  if(h01vodwatch is null,0,h01vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '02' hourstime,
							  if(h02ltvwatch is null,0,h02ltvwatch) hoursltvwatch,
							  if(h02vodwatch is null,0,h02vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '03' hourstime,
							  if(h03ltvwatch is null,0,h03ltvwatch) hoursltvwatch,
							  if(h03vodwatch is null,0,h03vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '04' hourstime,
							  if(h04ltvwatch is null,0,h04ltvwatch) hoursltvwatch,
							  if(h04vodwatch is null,0,h04vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '05' hourstime,
							  if(h05ltvwatch is null,0,h05ltvwatch) hoursltvwatch,
							  if(h05vodwatch is null,0,h05vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '06' hourstime,
							  if(h06ltvwatch is null,0,h06ltvwatch) hoursltvwatch,
							  if(h06vodwatch is null,0,h06vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '07' hourstime,
							  if(h07ltvwatch is null,0,h07ltvwatch) hoursltvwatch,
							  if(h07vodwatch is null,0,h07vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '08' hourstime,
							  if(h08ltvwatch is null,0,h08ltvwatch) hoursltvwatch,
							  if(h08vodwatch is null,0,h08vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '09' hourstime,
							  if(h09ltvwatch is null,0,h09ltvwatch) hoursltvwatch,
							  if(h09vodwatch is null,0,h09vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '10' hourstime,
							  if(h10ltvwatch is null,0,h10ltvwatch) hoursltvwatch,
							  if(h10vodwatch is null,0,h10vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '11' hourstime,
							  if(h11ltvwatch is null,0,h11ltvwatch) hoursltvwatch,
							  if(h11vodwatch is null,0,h11vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '12' hourstime,
							  if(h12ltvwatch is null,0,h12ltvwatch) hoursltvwatch,
							  if(h12vodwatch is null,0,h12vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '13' hourstime,
							  if(h13ltvwatch is null,0,h13ltvwatch) hoursltvwatch,
							  if(h13vodwatch is null,0,h13vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '14' hourstime,
							  if(h14ltvwatch is null,0,h14ltvwatch) hoursltvwatch,
							  if(h14vodwatch is null,0,h14vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '15' hourstime,
							  if(h15ltvwatch is null,0,h15ltvwatch) hoursltvwatch,
							  if(h15vodwatch is null,0,h15vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '16' hourstime,
							  if(h16ltvwatch is null,0,h16ltvwatch) hoursltvwatch,
							  if(h16vodwatch is null,0,h16vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '17' hourstime,
							  if(h17ltvwatch is null,0,h17ltvwatch) hoursltvwatch,
							  if(h17vodwatch is null,0,h17vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '18' hourstime,
							  if(h18ltvwatch is null,0,h18ltvwatch) hoursltvwatch,
							  if(h18vodwatch is null,0,h18vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '19' hourstime,
							  if(h19ltvwatch is null,0,h19ltvwatch) hoursltvwatch,
							  if(h19vodwatch is null,0,h19vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '20' hourstime,
							  if(h20ltvwatch is null,0,h20ltvwatch) hoursltvwatch,
							  if(h20vodwatch is null,0,h20vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '21' hourstime,
							  if(h21ltvwatch is null,0,h21ltvwatch) hoursltvwatch,
							  if(h21vodwatch is null,0,h21vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '22' hourstime,
							  if(h22ltvwatch is null,0,h22ltvwatch) hoursltvwatch,
							  if(h22vodwatch is null,0,h22vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					union all
					   select projectid,
							  if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
							  if(contentid is null,'ALL',contentid) contentid,
							  t.dtime dtime,
							  '23' hourstime,
							  if(h23ltvwatch is null,0,h23ltvwatch) hoursltvwatch,
							  if(h23vodwatch is null,0,h23vodwatch) hoursvodwatch
						 from video.t_video_hvs_hours_watch_d_hbase t
						where t.dtime > substr('{STARTTIME}',0,8)
						  and t.dtime < substr('{ENDTIME}',0,8)
					)tt
				group by projectid,activitychannelid,contentid,concat(dtime,hourstime),hoursltvwatch,hoursvodwatch
                ]]>
            </hql>
        </multiHqlReportIndex>

	<!--
	*********************************************************************************************
	//SDK话单,流量分布。流量=C5（码率）*C4（播放时长）/8之和
	//分时段（00~23H）各流量情况
	//
	//结算数据情况：
	projectid@110#dtime@20170510#
	projectid@110#networktype@120#dtime@20170510#
	projectid@110#platformid@120#dtime@20170510#
	projectid@110#networktype@119#platformid@120#dtime@20170510#
	*********************************************************************************************
	-->
        <multiHqlReportIndex>
            <indexKey>video.sdk.flow.hoursflow.h</indexKey>
			<macroList>
				<macro>
					<name>SDK_FLOW_HOUR</name>
					<value>
					<![CDATA[
					select t.c1 projectid,networktype,platformid,t.date dtime,
						   if(t.eventname = 'content_play', 1, 2) flowtype,
						   from_unixtime(unix_timestamp(t.time, 'yyyy-MM-dd HH:mm:ss'),'yyyyMMddHHmmss') datatime,
						   ((c5 * c4) / 8) watchflow,
						   userid
					  from video.t_cdr_sdk_event_join_video_user t
					 where substr(t.date,0,8) > substr('{STARTTIME}',0,8)
					   and substr(t.date,0,8) < substr('{ENDTIME}',0,8)
					   and (t.eventname = 'content_play' or t.eventname = 'live_play')
					]]>
					</value>
				</macro>
			</macroList>
            <fieldName>hoursvoduser,hoursvodwatchflow,hourslivetvuser,hourslivetvwatchflow</fieldName>
            <hql>
                <![CDATA[
				select projectid,networktype,platformid,htime,
					   count(distinct(tt.voduserid)) hoursvoduser,
					   sum(tt.vodwatchflow) hoursvodwatchflow,
					   count(distinct(tt.ltvuserid)) hourslivetvuser,
					   sum(tt.ltvwatchflow) hourslivetvwatchflow
				  from (select projectid,
							   if(t.networktype is null,'none',t.networktype) networktype,
							   'ALL' platformid,
							   substr(t.datatime,0,8) htime,
							   if(t.flowtype=1,t.watchflow,0) vodwatchflow,
							   if(t.flowtype=1,t.userid,null) voduserid,
							   if(t.flowtype=2,t.watchflow,0) ltvwatchflow,
							   if(t.flowtype=2,t.userid,null) ltvuserid,
						  from ({SDK_FLOW_HOUR})t
						 where 
					union all
						select projectid,
							   'ALL' networktype,
							   if(t.platformid is null,'none',t.platformid)  platformid,
							   substr(t.datatime,0,8) htime,
							   if(t.flowtype=1,t.watchflow,0) vodwatchflow,
							   if(t.flowtype=1,t.userid,null) voduserid,
							   if(t.flowtype=2,t.watchflow,0) ltvwatchflow,
							   if(t.flowtype=2,t.userid,null) ltvuserid,
						  from ({SDK_FLOW_HOUR})t
					union all
						select projectid,
							   if(t.networktype is null,'none',t.networktype) networktype,
							   if(t.platformid is null,'none',t.platformid) platformid,
							   substr(t.datatime,0,8) htime,
							   if(t.flowtype=1,t.watchflow,0) vodwatchflow,
							   if(t.flowtype=1,t.userid,null) voduserid,
							   if(t.flowtype=2,t.watchflow,0) ltvwatchflow,
							   if(t.flowtype=2,t.userid,null) ltvuserid,
						  from ({SDK_FLOW_HOUR})t
					union all
						select projectid,
							   'ALL' networktype,
							   'ALL' platformid,
							   substr(t.datatime,0,8) htime,
							   if(t.flowtype=1,t.watchflow,0) vodwatchflow,
							   if(t.flowtype=1,t.userid,null) voduserid,
							   if(t.flowtype=2,t.watchflow,0) ltvwatchflow,
							   if(t.flowtype=2,t.userid,null) ltvuserid,
						  from ({SDK_FLOW_HOUR})t
					)tt
				group by projectid,networktype,platformid,htime
                ]]>
            </hql>
        </multiHqlReportIndex>
		<!--
		//每时 总消耗流量 totalflowhours = 当期点播流量+直播流量
		//每时 平均每用户消耗直播流量 hourslivetvavgflow
		//每时 平均每用户消耗点播流量 hoursvodavgflow
		-->
        <multiHqlReportIndex>
            <indexKey>video.sdk.flow.totalavgflow.h</indexKey>
            <fieldName>totalflowhours,hourslivetvavgflow,hoursvodavgflow</fieldName>
            <hql>
                <![CDATA[
				select projectid,networktype,platformid,htime,
					   (hourslivetvwatchflow + hoursvodwatchflow) totalflowhours,
					   (hourslivetvwatchflow / hourslivetvuser) hourslivetvavgflow,
					   (hoursvodwatchflow / hoursvoduser) hoursvodavgflow
				  from (select projectid,networktype,platformid,htime,
							   if(t.hourslivetvuser is null, 0, t.hourslivetvuser) hourslivetvuser,
							   if(t.hourslivetvwatchflow is null, 0, t.hourslivetvwatchflow) hourslivetvwatchflow,
							   if(t.hoursvoduser is null, 0, t.hoursvoduser) hoursvoduser,
							   if(t.hoursvodwatchflow is null, 0, t.hoursvodwatchflow) hoursvodwatchflow
						  from video.t_video_sdk_flow_h_hbase t
						 where substr(t.htime, 0, 8) > substr('{STARTTIME}',0,8)
						   and substr(t.htime, 0, 8) < substr('{ENDTIME}',0,8)
					) tt
				 group by projectid,networktype,platformid,htime,
						  (hourslivetvwatchflow + hoursvodwatchflow),
						  (hourslivetvwatchflow / hourslivetvuser),
						  (hoursvodwatchflow / hoursvoduser)
                ]]>
            </hql>
        </multiHqlReportIndex>
		
		<!--
		//每时 直播流量 情况 hourslivetvwatchflow (h??livetvwatchflow)
		//每时 点播流量 情况 hoursvodwatchflow (h??vodwatchflow)
		//每时 直播用户 情况 hourslivetvuser (h??livetvuser)
		//每时 点播用户 情况 hoursvoduser (h??voduser)
		-->
        <multiHqlReportIndex>
            <indexKey>video.sdk.flow.hoursflow.hw</indexKey>
            <fieldName>whoursvoduser,whoursvodwatchflow,whourslivetvuser,whourslivetvwatchflow</fieldName>
            <hql>
                <![CDATA[
				select projectid,networktype,platformid,concat(dtime, hours) htime,
					   sum(hoursvoduser) whoursvoduser,
					   sum(hoursvodwatchflow) whoursvodwatchflow,
					   sum(hourslivetvuser) whourslivetvuser,
					   sum(hourslivetvwatchflow) whourslivetvwatchflow
				  from (select t1.projectid,
							   if(t1.networktype is null,'ALL',t1.networktype) networktype,
							   if(t1.platformid is null,'ALL',t1.platformid) platformid,
							   t2.dtime,
							   substr(t1.htime, 9, 2) hours,
							   if(t1.hourslivetvuser is null, 0, t1.hourslivetvuser) hourslivetvuser,
							   if(t1.hoursvoduser is null, 0, t1.hoursvoduser) hoursvoduser,
							   if(t1.hourslivetvwatchflow is null, 0, t1.hourslivetvwatchflow) hourslivetvwatchflow,
							   if(t1.hoursvodwatchflow is null, 0, t1.hoursvodwatchflow) hoursvodwatchflow
						  from (select projectid,networktype,platformid,htime,substr(t.htime, 0, 8) dtime,
									   hourslivetvuser,hoursvoduser,hourslivetvwatchflow,hoursvodwatchflow
								  from video.t_video_sdk_flow_h_hbase t
								 where substr(t.htime, 0, 8) > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(
													substr('{STARTTIME}',0,8),'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
								   and substr(t.htime, 0, 8) < substr('{ENDTIME}',0,8)
							) t1,
							   (select substr(t.dtime, 0, 8) dtime, t.weekdays,from_unixtime(unix_timestamp(t.dtime, 'yyyyMMdd'),'yyyy-MM-dd') formaltime
								  from video.t_bdi_muchtv_video_rundate t
								 where t.dtime > substr('{STARTTIME}', 0, 8)
								   and t.dtime < substr('{ENDTIME}',0,8)
							) t2
						 where substr(t1.htime, 0, 8) > from_unixtime(unix_timestamp(date_sub(t2.formaltime,t2.weekdays),'yyyy-MM-dd'),'yyyyMMdd')
						   and t1.dtime <= t2.dtime
					) tt
				 group by projectid, networktype, platformid, concat(dtime, hours)
                ]]>
            </hql>
        </multiHqlReportIndex>

		<!--
		//每时 总消耗流量 totalflowhours = 当期点播流量+直播流量
		//每时 平均每用户消耗直播流量 hourslivetvavgflow
		//每时 平均每用户消耗点播流量 hoursvodavgflow
		-->
        <multiHqlReportIndex>
            <indexKey>video.sdk.flow.totalavgflow.hw</indexKey>
            <fieldName>wtotalflowhours,whourslivetvavgflow,whoursvodavgflow</fieldName>
            <hql>
                <![CDATA[
				select projectid,networktype,platformid,htime,
					   (whourslivetvwatchflow + whoursvodwatchflow) wtotalflowhours,
					   (whourslivetvwatchflow / whourslivetvuser) whourslivetvavgflow,
					   (whoursvodwatchflow / whoursvoduser) whoursvodavgflow
				  from (select projectid,networktype,platformid,htime,
							   if(t.whourslivetvuser is null, 0, t.whourslivetvuser) hourslivetvuser,
							   if(t.whourslivetvwatchflow is null, 0, t.whourslivetvwatchflow) hourslivetvwatchflow,
							   if(t.whoursvoduser is null, 0, t.whoursvoduser) hoursvoduser,
							   if(t.whoursvodwatchflow is null, 0, t.whoursvodwatchflow) hoursvodwatchflow
						  from video.t_video_sdk_flow_h_hbase t
						 where substr(t.htime, 0, 8) > substr('{STARTTIME}',0,8)
						   and substr(t.htime, 0, 8) < substr('{ENDTIME}',0,8)
					) tt
				 group by projectid,networktype,platformid,htime,
						  (whourslivetvwatchflow + whoursvodwatchflow),
						  (whourslivetvwatchflow / whourslivetvuser),
						  (whoursvodwatchflow / whoursvoduser)

                ]]>
            </hql>
        </multiHqlReportIndex>
		
    </multiHqlReportIndexs>
</reportIndexGroup>
