<reportIndexGroup>
<multiHqlReportIndexs>
	<!--
	[201703]
	活跃用户数 activeusers
	日活用户数 dayactiveusers
	注册用户活跃数 registeruseractive
	注册用户活跃率 registeruseractiverate
	观看用户数 watchusers
	注册用户总数 totalregisteruser
	游客用户总数 totalvisitor
	
	[201707]
	修改活跃用户数 、注册用户活跃数、游客用户总数 从中间表获取t_mid_video_sdk_current_dm
	substr(t.dtime, 0, 6) <from_unixtime(unix_timestamp(date_add(from_unixtime(unix_timestamp(t.dtime,'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMM')
	取每月最后一天的数据
	-->
	<multiHqlReportIndex>
		<indexKey>video.edp.user.active.placolumns.m</indexKey>
		<fieldName>dayactiveusers,registeruseractiverate</fieldName>
		<hql>
			<![CDATA[
			select projectid,activitychannelid,platformid,mtime,
				   dayactiveusers,
				   registeruseractiverate
			  from (select t.projectid,
						   if(t.activitychannelid is null,'ALL',t.activitychannelid) activitychannelid,
						   if(t.platformid is null, 'ALL', t.platformid) platformid,
						   substr(t.dtime, 0, 6) mtime,
						   if(t.dayactiveusers is null, 0, t.dayactiveusers) dayactiveusers,
						   if(t.registeruseractiverate is null, 0, t.registeruseractiverate) registeruseractiverate
					  from video.t_video_develop_user_active_td_hbase t
					 where substr(t.dtime, 0, 6) > '{STARTTIME}'
					   and substr(t.dtime, 0, 6) < '{ENDTIME}'
					   and substr(t.dtime, 0, 6) <
						   from_unixtime(unix_timestamp(date_add(from_unixtime(unix_timestamp(t.dtime,
							'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMM')
				) tt
			 group by projectid,activitychannelid,platformid,mtime,
					  dayactiveusers,
					  registeruseractiverate
			]]>
		</hql>
	</multiHqlReportIndex>
	<!--watchusers,totalregisteruser 不区分终端-->
	<multiHqlReportIndex>
		<indexKey>video.edp.user.active.columns.m</indexKey>
		<fieldName>watchusers,totalregisteruser</fieldName>
		<hql>
			<![CDATA[
			select projectid,activitychannelid,platformid,mtime,
				   watchusers,
				   totalregisteruser
			  from (select t.projectid,
						   if(t.activitychannelid is null,'ALL',t.activitychannelid) activitychannelid,
						   if(t.platformid is null, 'ALL', t.platformid) platformid,
						   substr(t.dtime, 0, 6) mtime,
						   if(t.watchusers is null, 0, t.watchusers) watchusers,
						   if(t.totalregisteruser is null, 0, t.totalregisteruser) totalregisteruser
					  from video.t_video_develop_user_active_td_hbase t
					 where substr(t.dtime, 0, 6) > '{STARTTIME}'
					   and substr(t.dtime, 0, 6) < '{ENDTIME}'
					   and substr(t.dtime, 0, 6) <
						   from_unixtime(unix_timestamp(date_add(from_unixtime(unix_timestamp(t.dtime,
							'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMM')
					   and t.platformid is null
				) tt
			 group by projectid,activitychannelid,platformid,mtime,
					  watchusers,
					  totalregisteruser
			]]>
		</hql>
	</multiHqlReportIndex>
    <!-- 
    [201707]
	修改活跃用户数 、注册用户活跃数、游客用户总数 从中间表获取t_mid_video_sdk_current_dm
	201708需求，从t_mid_video_sdk_current_d获取appdownload
	 -->
	<multiHqlReportIndex>
		<indexKey>video.edp.user.active.activeusers.m</indexKey>
		<fieldName>activeusers,registeruseractive,totalvisitor,appdownload</fieldName>
		<hql>
			<![CDATA[
			select projectid,activitychannelid,platformid,mtime,
				   sum(tt.activeusers) activeusers,
				   sum(tt.registeruseractive) registeruseractive,
				   sum(tt.totalvisitor) totalvisitor,
				   sum(appdownload) appdownload
			  from (select t.projectid,
						   activitychannelid,
						   platformid,
						   substr(t.dtime, 0, 6) mtime,
						   activeusers,
						   registeruseractive,
						   totalvisitor,
						   appdownload
					  from video.t_mid_video_sdk_current_dm t
					 where substr(t.date, 0, 6) > '{STARTTIME}'
					   and substr(t.date, 0, 6) < '{ENDTIME}'
					   and substr(t.date, 0, 6) <
						   from_unixtime(unix_timestamp(date_add(from_unixtime(unix_timestamp(t.date,
							'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMM')
					   and t.activityid = 'ALL'
				) tt
			 group by projectid,activitychannelid,platformid,mtime
			]]>
		</hql>
	</multiHqlReportIndex>
</multiHqlReportIndexs>
</reportIndexGroup>
