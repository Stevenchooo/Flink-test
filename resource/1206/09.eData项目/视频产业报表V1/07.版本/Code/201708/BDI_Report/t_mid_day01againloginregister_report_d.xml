<reportSuite>
    <reports>
        <report tableName = "t_video_sdk_current_d"
				keyFields = "projectid,activitychannelid,platformid,dtime" 
				period = "daily" timeFormat = "yyyyMMdd" timeField = "dtime">
            <fieldDefinition>
                <field name="projectid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activitychannelid" regular="[0-9a-zA-Z./-]*"/>
				<field name="platformid" regular="[0-9a-zA-Z./-]*"/>
                <field name="dtime"  regular="[0-9a-zA-Z./-]*"/>
            </fieldDefinition>
			<materialViewers>
				<!--day01againloginregister-->
				<materialViewer tableName = "video.t_mid_day01againloginregister_tmp" clear="false" partition="date">
					<hql>
					<![CDATA[
				    select projectid,
					       if(platformid is null,'ALL',platformid) platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid) day01againloginregister,
						   dtime date
				     from (
						select t1.projectid projectid,
							   t1.activitychannelid ,
							   t1.activityid,
							   if(t2.platformid is null,'none',t2.platformid) platformid,
							   t1.dtime dtime,
							   t1.identityid identityid
						  from (select projectid,activitychannelid,activityid,platformid,t.date dtime,identityid
								  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  join (select distinct projectid,platformid,t.date dtime,userid
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									) t2
							on t1.identityid = t2.userid
						   and t1.projectid = t2.projectid
						   and t1.dtime = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.dtime,
											'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
						  ) tt
						 group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime),
						 (projectid,activitychannelid,dtime),
						 (projectid,activityid,dtime),
						 (projectid,platformid,dtime),
						 (projectid,dtime)
					   ) 
					]]>
					</hql>
				</materialViewer>
			</materialViewers>
        </report>
    </reports>
</reportSuite>
