<reportSuite>
    <reports>
        <report tableName = "t_video_sdk_current_d"
				keyFields = "projectid,activitychannelid,activityid,platformid,dtime" 
				period = "daily" timeFormat = "yyyyMMdd" timeField = "dtime">
            <fieldDefinition>
                <field name="projectid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activitychannelid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activityid" regular="[0-9a-zA-Z./-]*"/>
				<field name="platformid" regular="[0-9a-zA-Z./-]*"/>
                <field name="dtime"  regular="[0-9a-zA-Z./-]*"/>
            </fieldDefinition>
			<!--
			  新增游客总用户数，当天结算
			-->
			<materialViewers>
				<materialViewer tableName = "video.t_mid_video_sdk_totalvisitor_d" clear="false" partition="date">
					<hql>
					<![CDATA[
				 select projectid,
				        if(platformid is null,'ALL',platformid) platformid,
				        if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
				        if(activityid is null,'ALL',activityid) activityid,
				        dtime,
				        count(distinct(userid)) totalvisitor,dtime date
			  from (select t1.c1 projectid, 
			               'none' activitychannelid, 
						   'none' activityid,
						   if(t1.platformid is null, 'none', t1.platformid) platformid,
						   t2.dtime, 
						   t1.userid
					  from (select *
							  from video.t_cdr_sdk_event_join_video_user t
							 where t.eventname = 'login'
							   and t.eventlabel = 'guest') t1,
						   (select dtime
							  from video.t_bdi_muchtv_video_rundate t
							 where t.dtime > '{STARTTIME}'
							   and t.dtime < '{ENDTIME}') t2
					 where t1.date <= t2.dtime
					) tt
			 group by projectid,activitychannelid,activityid,platformid,dtime
			  grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime),
						 (projectid,activitychannelid,dtime),
						 (projectid,activityid,dtime),
						 (projectid,platformid,dtime),
						 (projectid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
			</materialViewers>
        </report>
    </reports>
</reportSuite>
