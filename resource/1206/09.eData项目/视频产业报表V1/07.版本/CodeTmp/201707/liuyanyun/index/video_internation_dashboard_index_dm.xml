<reportIndexGroup>
<!--
头数据展示为 'ALL' projectid
筛选条件为	 'ALL' region 或者 region

列数据为 projectid@#region@#dtime@#
区域 area 
国家 country
项目名称 projectname
收入 
注册
游客
日活
活跃
-->
    <multiHqlReportIndexs>
		<!--
		//国家 country
		//项目名称 projectname
		//收入[income,localincome]
		//注册用户总数[totalregisteruser]
		//游客用户总数[totalvisitor]
		//日活用户数  [dayactiveusers]
		//活跃用户数  [activeusers]
		//总播放流量  [totalflow]
		-->
        <multiHqlReportIndex>
            <indexKey>video.internation.dashboard.columns.dm</indexKey>
            <fieldName>projectname,country,income,localincome,totalregisteruser,totalvisitor,dayactiveusers,activeusers,totalflow</fieldName>
            <hql>
                <![CDATA[
				select projectid,area,dtime,
					   projectname,
					   country,
					   sum(income) income,
					   sum(localincome) localincome,
					   sum(totalregisteruser) totalregisteruser,
					   sum(totalvisitor) totalvisitor,
					   sum(dayactiveusers) dayactiveusers,
					   sum(activeusers) activeusers,
					   sum(totalflow) totalflow
				  from (select 'ALL' projectid,
							   'ALL' area,
							   dtime,
							   'none' projectname,
							   'none' country,
							   income,
							   localincome,
							   totalregisteruser,
							   totalvisitor,
							   dayactiveusers,
							   activeusers,
							   totalflow
						  from video.t_video_internation_dashboard_pid_dm_hbase t
						 where t.dtime > '{STARTTIME}'
						   and t.dtime < '{ENDTIME}'
					union all
						select 'ALL' projectid,
							   t2.area,
							   t1.dtime,
							   'none' projectname,
							   'none' country,
							   t1.income,
							   t1.localincome,
							   t1.totalregisteruser,
							   t1.totalvisitor,
							   t1.dayactiveusers,
							   t1.activeusers,
							   t1.totalflow
						  from (select projectid,dtime,totalregisteruser,totalvisitor,dayactiveusers,activeusers,totalflow,income,localincome
								  from video.t_video_internation_dashboard_pid_dm_hbase t
								 where t.dtime > '{STARTTIME}'
								   and t.dtime < '{ENDTIME}') t1
						  left join (select projectid, area
									  from video.t_cdr_oracle_video_project t) t2
							on t1.projectid = t2.projectid
					union all
						select t1.projectid,
							   t2.area,
							   t1.dtime,
							   t2.projectname,
							   t2.country,
							   t1.income,
							   t1.localincome,
							   t1.totalregisteruser,
							   t1.totalvisitor,
							   t1.dayactiveusers,
							   t1.activeusers,
							   t1.totalflow
						  from (select projectid,dtime,totalregisteruser,totalvisitor,dayactiveusers,activeusers,totalflow,income,localincome
								  from video.t_video_internation_dashboard_pid_dm_hbase t
								 where t.dtime > '{STARTTIME}'
								   and t.dtime < '{ENDTIME}') t1
						  left join (select projectid, projectname, area, country
									  from video.t_cdr_oracle_video_project t) t2
							on t1.projectid = t2.projectid
					) tt
				group by projectid,area,dtime,projectname,country
                ]]>
            </hql>
        </multiHqlReportIndex>
		
		<!--活跃用户DOU	douflow = 总播放流量 totalflow/活跃用户数 -->
        <multiHqlReportIndex>
            <indexKey>video.internation.dashboard.douflow.dm</indexKey>
            <fieldName>douflow</fieldName>
            <hql>
                <![CDATA[
				select projectid, area, dtime, (totalflow / activeusers) douflow
				  from (select if(t.projectid is null, 'ALL', t.projectid) projectid,
							   if(t.area is null, 'ALL', t.area) area,
							   dtime,
							   totalflow,
							   activeusers
						  from video.t_video_internation_dashboard_dm_hbase t
						 where t.dtime > '{STARTTIME}'
						   and t.dtime < '{ENDTIME}') tt
				 group by projectid, area, dtime, (totalflow / activeusers)
                ]]>
            </hql>
        </multiHqlReportIndex>

    </multiHqlReportIndexs>
</reportIndexGroup>
