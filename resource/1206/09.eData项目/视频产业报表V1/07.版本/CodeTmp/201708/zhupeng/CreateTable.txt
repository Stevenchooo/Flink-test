--2Bdata 表
DROP TABLE video.t_video_2BData_data_d_hbase;
CREATE EXTERNAL TABLE video.t_video_2BData_data_d_hbase
(
key                     string,
projectid               string,
dtime                   string,
newvisitor              int,
activeusers             int,
totalvisitor            int,
registeruseractive      int,
activeusers_m           int,
registeruseractive_m    int,
newregisteruser         int,
totalregisteruser       int,
totalactiveaccount      int,
newpay                  int,
pay                     int,
pay_m                   int,
paytotal                int,
newincome               double,
arpuincome              double,
videosnumber            int,
playtimes               int,
playusers               int,
playtime                int,
percapitaplaytime       double,
percapitaplay           double,
avgvideotime            double,
devicearpu              double,
accountarpu             double
)
STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' 
WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key,
indexvalue:PROJECTID,
indexvalue:DTIME,
indexvalue:newvisitor,
indexvalue:activeusers,
indexvalue:totalvisitor,
indexvalue:registeruseractive,
indexvalue:activeusers_m,
indexvalue:registeruseractive_m,
indexvalue:newregisteruser,
indexvalue:totalregisteruser,
indexvalue:totalactiveaccount,
indexvalue:newpay,
indexvalue:pay,
indexvalue:pay_m,
indexvalue:paytotal,
indexvalue:newincome,
indexvalue:arpuincome,
indexvalue:videosnumber,
indexvalue:playtimes,
indexvalue:playusers,
indexvalue:playtime,
indexvalue:percapitaplaytime,
indexvalue:percapitaplay,
indexvalue:avgvideotime,
indexvalue:devicearpu,
indexvalue:accountarpu
") 
TBLPROPERTIES ("hbase.table.name" = "t_video_2BData_data_d");
grant select,delete,insert on video.t_video_2BData_data_d_hbase to user mapred;



--留存中间表
drop table video.t_mid_day_notconvert_registeredusers;
create table video.t_mid_day_notconvert_registeredusers
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
identityid         string
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_day_notconvert_registeredusers to user mapred;

drop table video.t_mid_newsubscriber_tmp;
create table video.t_mid_newsubscriber_tmp
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
newsubscriber      int
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_newsubscriber_tmp to user mapred;

drop table video.t_mid_day01againloginregister_tmp;
create table video.t_mid_day01againloginregister_tmp
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
day01againloginregister      int
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_day01againloginregister_tmp to user mapred;

drop table video.t_mid_day03againloginregister_tmp;
create table video.t_mid_day03againloginregister_tmp
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
day03againloginregister      int
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_day03againloginregister_tmp to user mapred;

drop table video.t_mid_day07againloginregister_tmp;
create table video.t_mid_day07againloginregister_tmp
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
day07againloginregister      int
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_day07againloginregister_tmp to user mapred;

drop table video.t_mid_day15againloginregister_tmp;
create table video.t_mid_day15againloginregister_tmp
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
day15againloginregister      int
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_day15againloginregister_tmp to user mapred;


drop table video.t_mid_day30againloginregister_tmp;
create table video.t_mid_day30againloginregister_tmp
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
day30againloginregister      int
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_day30againloginregister_tmp to user mapred;

drop table video.t_mid_video_sdk_retentionrate_d;
create table video.t_mid_video_sdk_retentionrate_d
(
projectid          string,
platformid         string,
activitychannelid  string,
activityid         string,
dtime              string,
newsubscriber           int,
day01retentionrate      double,
day03retentionrate      double,
day07retentionrate      double,
day15retentionrate      double,
day30retentionrate      double
)
partitioned by(
id string,
date string
)
row format delimited fields terminated by '\t' map keys terminated by '&' stored as textfile;
grant select,delete,insert on t_mid_video_sdk_retentionrate_d to user mapred;

--修改t_video_sdk_current_d表
alter table video.t_mid_video_sdk_current_d 
  add columns (newsubscriber int ,day01retentionrate double,day03retentionrate double,day07retentionrate double,day15retentionrate double,day30retentionrate double);
  
DROP TABLE video.t_video_users_retention_d_hbase;
CREATE EXTERNAL TABLE video.t_video_users_retention_d_hbase
(
key string,
projectid string,
platformid string,
activitychannelid string,
activityid string,
dtime string,
newsubscriber      int,
day01retentionrate double,
day03retentionrate double,
day07retentionrate double,
day15retentionrate double,
day30retentionrate double,
avgday01retentionrate double,
avgday03retentionrate double,
avgday07retentionrate double,
avgday15retentionrate double,
avgday30retentionrate double
)
STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' 
WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key,
indexvalue:PROJECTID,
indexvalue:PLATFORMID,
indexvalue:ACTIVITYCHANNELID,
indexvalue:ACTIVITYID,
indexvalue:DTIME,
indexvalue:NEWSUBSCRIBER,
indexvalue:DAY01RETENTIONRATE,
indexvalue:DAY03RETENTIONRATE,
indexvalue:DAY07RETENTIONRATE,
indexvalue:DAY15RETENTIONRATE,
indexvalue:DAY30RETENTIONRATE,
indexvalue:AVGDAY01RETENTIONRATE,
indexvalue:AVGDAY03RETENTIONRATE,
indexvalue:AVGDAY07RETENTIONRATE,
indexvalue:AVGDAY15RETENTIONRATE,
indexvalue:AVGDAY30RETENTIONRATE
") 
TBLPROPERTIES ("hbase.table.name" = "t_video_users_retention_d");
grant select,delete,insert on t_video_users_retention_d_hbase to user mapred;

