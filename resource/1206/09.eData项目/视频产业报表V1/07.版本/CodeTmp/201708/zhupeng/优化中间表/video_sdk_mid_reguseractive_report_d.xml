<reportSuite>
    <reports>
        <report tableName = "t_video_sdk_current_d"
				keyFields = "projectid,activitychannelid,activityid,platformid,dtime" 
				period = "daily" timeFormat = "yyyyMMdd" timeField = "dtime">
            <fieldDefinition>
                <field name="projectid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activitychannelid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activityid" regular="[0-9a-zA-Z./-]*"/>
				<field name="platformid" regular="[0-9a-zA-Z./-]*"/>
                <field name="dtime"  regular="[0-9a-zA-Z./-]*"/>
            </fieldDefinition>
			<!--
			  注册用户活跃数，当天结算
			-->
			<materialViewers>
				<materialViewer tableName = "video.t_mid_video_sdk_reguseractive_d" clear="false" partition="id,date">
					<hql>
					<![CDATA[
			 select projectid,
			        if(platformid is null,'ALL',platformid) platformid,
				    if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
				    if(activityid is null,'ALL',activityid) activityid,
			        dtime,
					count(distinct(userid)) registeruseractive,
                    projectid id, dtime date					  
			  from (select t.c1 projectid,
						   if(t.activitychannelid is null, 'none', t.activitychannelid) activitychannelid,
						   if(t.activityid is null, 'none', t.activityid) activityid,
						   if(t.platformid is null, 'none', t.platformid) platformid,
						   t.date dtime,
						   userid
					  from video.t_cdr_sdk_event_join_video_user t
					 where t.date > '{STARTTIME}'
					   and t.date < '{ENDTIME}'
					   and t.usertype <> 'guest'
				) tt
			 group by projectid,platformid,activitychannelid,activityid,dtime
			 grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime),
						 (projectid,activitychannelid,dtime),
						 (projectid,activityid,dtime),
						 (projectid,platformid,dtime),
						 (projectid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
			</materialViewers>
        </report>
    </reports>
</reportSuite>
