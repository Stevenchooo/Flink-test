<reportSuite>
    <reports>
        <report tableName = "t_video_sdk_current_dm"
				keyFields = "projectid,activitychannelid,activityid,platformid,dtime" 
				period = "daily" timeFormat = "yyyyMMdd" timeField = "dtime">
            <fieldDefinition>
                <field name="projectid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activitychannelid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activityid" regular="[0-9a-zA-Z./-]*"/>
				<field name="platformid" regular="[0-9a-zA-Z./-]*"/>
                <field name="dtime"  regular="[0-9a-zA-Z./-]*"/>
            </fieldDefinition>
			<!--
			  注册用户活跃数，当月结算
			-->
			<materialViewers>
				<materialViewer tableName = "video.t_mid_video_sdk_reguseractive_dm" clear="false" partition="id,date">
					<hql>
					<![CDATA[
			 select projectid,
			        if(platformid is null,'ALL',platformid) platformid,
				    if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
				    if(activityid is null,'ALL',activityid) activityid,dtime,
					count(distinct(userid)) registeruseractive,projectid id, dtime date
			  from (select t1.projectid,
						   if(t1.activitychannelid is null, 'none', t1.activitychannelid) activitychannelid,
						   if(t1.activityid is null, 'none', t1.activityid) activityid,
						   if(t1.platformid is null, 'none', t1.platformid) platformid,
						   t2.dtime,
						   t1.userid
					  from (select t.c1 projectid,t.activitychannelid,t.activityid,t.platformid,t.date dtime,userid
							  from video.t_cdr_sdk_event_join_video_user t
							 where substr(t.date, 0, 6) >= substr('{STARTTIME}', 0, 6)
							   and substr(t.date, 0, 6) <= substr('{ENDTIME}', 0, 6)
							   and t.usertype <> 'guest') t1,
						   (select t.dtime, t.weekdays
							  from video.t_bdi_muchtv_video_rundate t
							 where t.dtime > '{STARTTIME}'
							   and t.dtime < '{ENDTIME}') t2
					 where substr(t1.dtime, 0, 6) = substr(t2.dtime, 0, 6)
					   and t1.dtime <= t2.dtime
				) tt
			 group by projectid,activitychannelid,activityid,platformid,dtime
			 grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime),
						 (projectid,activitychannelid,dtime),
						 (projectid,activityid,dtime),
						 (projectid,platformid,dtime),
						 (projectid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
			</materialViewers>
        </report>
    </reports>
</reportSuite>
