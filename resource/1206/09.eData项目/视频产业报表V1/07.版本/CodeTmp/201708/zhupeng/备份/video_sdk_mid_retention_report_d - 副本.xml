<reportSuite>
    <reports>
        <report tableName = "t_video_sdk_current_d"
				keyFields = "projectid,activitychannelid,activityid,platformid,dtime" 
				period = "daily" timeFormat = "yyyyMMdd" timeField = "dtime">
            <fieldDefinition>
                <field name="projectid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activitychannelid" regular="[0-9a-zA-Z./-]*"/>
				<field name="activityid" regular="[0-9a-zA-Z./-]*"/>
				<field name="platformid" regular="[0-9a-zA-Z./-]*"/>
                <field name="dtime"  regular="[0-9a-zA-Z./-]*"/>
            </fieldDefinition>
			<materialViewers>
				<materialViewer tableName = "video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS" clear="false" partition="id,date">
				<!--
			******************************************************************************************
			//物化视图
			//新增非游客转化的注册用户数 newregisterusers
			//	新增注册用户数需要扣除由新增游客转化过来的用户，
			//	其中具体计算根据注册话单中的DID如果找到之前（30天内）有游客登录话单则不算新增注册用户。
			//若在浏览器中一键注册后，又进行注销操作，
			******************************************************************************************
			-->
					<hql>
					<![CDATA[
					select projectid,activitychannelid,activityid,clientid,dtime,identityid,time,projectid id,dtime date
					  from (select distinct tt.*
							  from (select t.projectid,t.activitychannelid,t.activityid,t.clientid,t.dtime,t.identityid,t.time
									  from (select projectid,activitychannelid,activityid,clientid,t.date dtime,identityid,deviceid,time
											  from video.t_cdr_top_user_info t
											 where t.date > '{STARTTIME}'
											   and t.date < '{ENDTIME}'
											   and t.actiontype = 1
										) t
									  left join (select distinct r2.dtime dtime,r1.deviceid
												  from video.t_cdr_sdk_event_join_video_user r1,
													   (select t.dtime
														  from video.t_bdi_muchtv_video_rundate t
														 where t.dtime > '{STARTTIME}'
														   and t.dtime < '{ENDTIME}') r2
												 where r1.date >
													   from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(r2.dtime,
														'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
												   and r1.date <
													   from_unixtime(unix_timestamp(date_add(from_unixtime(unix_timestamp(r2.dtime,
														'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
												   and r1.deviceid = r1.userid
												   and r1.eventname = 'login'
												   and r1.eventlabel = 'guest'
										) s
										on t.deviceid = s.deviceid and t.dtime=s.dtime
									 where s.deviceid is null and s.dtime is null
								) tt
						) tb
					]]>
					</hql>
				</materialViewer>
				<!-- novisitorconvert-->
				<materialViewer tableName = "video.t_mid_novisitorconvert_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
					       platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid ) novisitorconvert,
						   projectid id,dtime date
					  from (
						select projectid,
							   if(activitychannelid is null,'none',activitychannelid) activitychannelid,
							   if(activityid is null,'none',activityid) activityid,
							   'ALL' platformid,
							   t.date dtime,
							   identityid
						  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
						 where t.date > '{STARTTIME}'
						   and t.date < '{ENDTIME}'
						     ) tt
					group by projectid,activitychannelid,activityid,platformid,dtime
				 grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,platformid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
				<!-- newvisitor-->
				<materialViewer tableName = "video.t_mid_newvisitor_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				     select projectid,platformid,activitychannelid,activityid,dtime,newvisitor,projectid id,dtime date
					   from video.t_mid_video_sdk_current_d t
					  where t.date > '{STARTTIME}'
						and t.date < '{ENDTIME}' 
						and t.newvisitor is not null
						and platformid='ALL'
						and newvisitor<>0
					]]>
					</hql>
				</materialViewer>
				<!--day01againloginregister-->
				<materialViewer tableName = "video.t_mid_day01againloginregister_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
					       platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid) day01againloginregister,
						   projectid id,dtime date
				     from (
						select t1.projectid projectid,
							   if(t1.activitychannelid is null,'none',t1.activitychannelid) activitychannelid,
							   if(t1.activityid is null,'none',t1.activityid) activityid,
							   'ALL' platformid,
							   t1.dtime dtime,
							   t1.identityid identityid
						  from (select projectid,activitychannelid,activityid,t.date dtime,identityid
								  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select projectid,activitychannelid,activityid,t.date dtime,userid
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.projectid is not null
									   and t.deviceid <> userid
									   and t.eventname = 'login'
									) t2
							on t1.identityid = t2.userid
						 where t1.projectid = t2.projectid
						   and ((t1.activitychannelid is null and t2.activitychannelid is null) or
							     t1.activitychannelid = t2.activitychannelid)
						   and ((t1.activityid is null and t2.activityid is null) or
							     t1.activityid = t2.activityid)
						   and t1.dtime = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.dtime,
											'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
						  ) tt
						 group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,platformid,dtime)
					   ) 
					]]>
					</hql>
				</materialViewer>
				<!--day03againloginregister-->
				<materialViewer tableName = "video.t_mid_day03againloginregister_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
					       platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid) day03againloginregister,
						   projectid id,dtime date
				     from (
						select t1.projectid projectid,
							   if(t1.activitychannelid is null,'none',t1.activitychannelid) activitychannelid,
							   if(t1.activityid is null,'none',t1.activityid) activityid,
							   'ALL' platformid,
							   t1.dtime dtime,
							   t1.identityid identityid
						  from (select projectid,activitychannelid,activityid,t.date dtime,identityid
								  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select projectid,activitychannelid,activityid,t.date dtime,userid
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.projectid is not null
									   and t.deviceid <> userid
									   and t.eventname = 'login'
									) t2
							on t1.identityid = t2.userid
						 where t1.projectid = t2.projectid
						   and ((t1.activitychannelid is null and t2.activitychannelid is null) or
							     t1.activitychannelid = t2.activitychannelid)
						   and ((t1.activityid is null and t2.activityid is null) or
							     t1.activityid = t2.activityid)
						   and t1.dtime = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.dtime,
											'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
						  ) tt
						 group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,platformid,dtime)
					   )  
					]]>
					</hql>
				</materialViewer>
			    <!--day07againloginregister-->
				<materialViewer tableName = "video.t_mid_day07againloginregister_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
					       platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid) day07againloginregister,
						   projectid id,dtime date
				     from (
						select t1.projectid projectid,
							   if(t1.activitychannelid is null,'none',t1.activitychannelid) activitychannelid,
							   if(t1.activityid is null,'none',t1.activityid) activityid,
							   'ALL' platformid,
							   t1.dtime dtime,
							   t1.identityid identityid
						  from (select projectid,activitychannelid,activityid,t.date dtime,identityid
								  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select projectid,activitychannelid,activityid,t.date dtime,userid
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.projectid is not null
									   and t.deviceid <> userid
									   and t.eventname = 'login'
									) t2
							on t1.identityid = t2.userid
						 where t1.projectid = t2.projectid
						   and ((t1.activitychannelid is null and t2.activitychannelid is null) or
							     t1.activitychannelid = t2.activitychannelid)
						   and ((t1.activityid is null and t2.activityid is null) or
							     t1.activityid = t2.activityid)
						   and t1.dtime = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.dtime,
											'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
						  ) tt
						 group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,platformid,dtime)
					   ) 
					]]>
					</hql>
				</materialViewer>
				<!--day15againloginregister-->
				<materialViewer tableName = "video.t_mid_day15againloginregister_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
				           platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid) day15againloginregister,
						   projectid id,dtime date
				     from (
						select t1.projectid projectid,
							   if(t1.activitychannelid is null,'none',t1.activitychannelid) activitychannelid,
							   if(t1.activityid is null,'none',t1.activityid) activityid,
							   'ALL' platformid,
							   t1.dtime dtime,
							   t1.identityid identityid
						  from (select projectid,activitychannelid,activityid,t.date dtime,identityid
								  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select projectid,activitychannelid,activityid,t.date dtime,userid
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.projectid is not null
									   and t.deviceid <> userid
									   and t.eventname = 'login'
									) t2
							on t1.identityid = t2.userid
						 where t1.projectid = t2.projectid
						   and ((t1.activitychannelid is null and t2.activitychannelid is null) or
							     t1.activitychannelid = t2.activitychannelid)
						   and ((t1.activityid is null and t2.activityid is null) or
							     t1.activityid = t2.activityid)
						   and t1.dtime = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.dtime,
											'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
						  ) tt
						 group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,platformid,dtime)
					   ) 
					]]>
					</hql>
				</materialViewer>
				<!--day30againloginregister-->
				<materialViewer tableName = "video.t_mid_day30againloginregister_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
				           platformid,
					       if(activitychannelid is null,'ALL',activitychannelid) activitychannelid,
						   if(activityid is null,'ALL',activityid) activityid,
						   dtime,
						   count(distinct identityid) day30againloginregister,
						   projectid id,dtime date
				     from (
						select t1.projectid projectid,
							   if(t1.activitychannelid is null,'none',t1.activitychannelid) activitychannelid,
							   if(t1.activityid is null,'none',t1.activityid) activityid,
							   'ALL' platformid,
							   t1.dtime dtime,
							   t1.identityid identityid
						  from (select projectid,activitychannelid,activityid,t.date dtime,identityid
								  from video.T_MID_DAY_NOTCONVERT_REGISTEREDUSERS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select projectid,activitychannelid,activityid,t.date dtime,userid
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.projectid is not null
									   and t.deviceid <> userid
									   and t.eventname = 'login'
									) t2
							on t1.identityid = t2.userid
						 where t1.projectid = t2.projectid
						   and ((t1.activitychannelid is null and t2.activitychannelid is null) or
							     t1.activitychannelid = t2.activitychannelid)
						   and ((t1.activityid is null and t2.activityid is null) or
							     t1.activityid = t2.activityid)
						   and t1.dtime = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.dtime,
											'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
						  ) tt
						 group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activityid,platformid,dtime),
						 (projectid,activitychannelid,platformid,dtime),
						 (projectid,platformid,dtime)
					   ) 
					]]>
					</hql>
				</materialViewer>
				<!--day01againloginvisitor-->
				<materialViewer tableName = "video.t_mid_day01againloginvisitor_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
				           if(platformid is null,'ALL',platformid) platformid,
					       activitychannelid,
						   activityid,
						   dtime,
						   count(distinct(userid)) day01againloginvisitor,
						   projectid id,dtime date
					   from 
					    (
						select t1.projectid,
							   'ALL' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
						 union all
						select t1.projectid,
							   'none' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
					     union all 	
                        select t1.projectid,
							   'ALL' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')	        
                         union all 	
                        select t1.projectid,
							   'none' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),1),'yyyy-MM-dd'),'yyyyMMdd')	
                         )tt								
					     group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
				<!--day03againloginvisitor-->
				<materialViewer tableName = "video.t_mid_day03againloginvisitor_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
					       if(platformid is null,'ALL',platformid) platformid,
					       activitychannelid,
						   activityid,
						   dtime,
						   count(distinct(userid)) day03againloginvisitor,
						   projectid id,dtime date
					   from 
					    (
						select t1.projectid,
							   'ALL' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
						 union all
						select t1.projectid,
							   'none' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
					     union all 	
                        select t1.projectid,
							   'ALL' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')	        
                         union all 	
                        select t1.projectid,
							   'none' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),3),'yyyy-MM-dd'),'yyyyMMdd')	
                         )tt								
					     group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
				<!--day07againloginvisitor-->
				<materialViewer tableName = "video.t_mid_day07againloginvisitor_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
				           if(platformid is null,'ALL',platformid) platformid,
					       activitychannelid,
						   activityid,
						   dtime,
						   count(distinct(userid)) day07againloginvisitor,
						   projectid id,dtime date
					   from 
					    (
						select t1.projectid,
							   'ALL' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
						 union all
						select t1.projectid,
							   'none' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
					     union all 	
                        select t1.projectid,
							   'ALL' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')	        
                         union all 	
                        select t1.projectid,
							   'none' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),7),'yyyy-MM-dd'),'yyyyMMdd')	
                         )tt								
					     group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
				<!--day15againloginvisitor-->
				<materialViewer tableName = "video.t_mid_day15againloginvisitor_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				    select projectid,
					       if(platformid is null,'ALL',platformid) platformid,
					       activitychannelid,
						   activityid,
						   dtime,
						   count(distinct(userid)) day15againloginvisitor,
						   projectid id,dtime date
					   from 
					    (
						select t1.projectid,
							   'ALL' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
						 union all
						select t1.projectid,
							   'none' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
					     union all 	
                        select t1.projectid,
							   'ALL' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')	        
                         union all 	
                        select t1.projectid,
							   'none' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),15),'yyyy-MM-dd'),'yyyyMMdd')	
                         )tt								
					     group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
				<!--day30againloginvisitor-->
				<materialViewer tableName = "video.t_mid_day30againloginvisitor_tmp" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				   select projectid,
				           if(platformid is null,'ALL',platformid) platformid,
					       activitychannelid,
						   activityid,
						   dtime,
						   count(distinct(userid)) day30againloginvisitor,
						   projectid id,dtime date
					   from 
					    (
						select t1.projectid,
							   'ALL' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
						 union all
						select t1.projectid,
							   'none' activitychannelid,
							   'ALL' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
					     union all 	
                        select t1.projectid,
							   'ALL' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')	        
                         union all 	
                        select t1.projectid,
							   'none' activitychannelid,
							   'none' activityid,
							   if(platformid is null,'none',platformid) platformid,
							   t1.date dtime,
							   t1.userid userid
						  from (select *
								  from video.T_MID_DAY_NEWLOGIN_VISITORS t
								 where t.date > from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{STARTTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
								   and t.date < from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp('{ENDTIME}',
												'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')
							) t1
						  left join (select *
									  from video.t_cdr_sdk_event_join_video_user t
									 where t.date > '{STARTTIME}'
									   and t.date < '{ENDTIME}'
									   and t.eventname = 'login'
									   and t.eventlabel = 'guest') t2
							on t1.userid = t2.userid
						 where t1.projectid = t2.c1
						   and t1.date = from_unixtime(unix_timestamp(date_sub(from_unixtime(unix_timestamp(t2.date,
										'yyyyMMdd'),'yyyy-MM-dd'),30),'yyyy-MM-dd'),'yyyyMMdd')	
                         )tt								
					     group by projectid,activitychannelid,activityid,platformid,dtime
				      grouping sets
				       (
					     (projectid,activitychannelid,activityid,platformid,dtime),
						 (projectid,activitychannelid,activityid,dtime)
					   )
					]]>
					</hql>
				</materialViewer>
				<!--retentionrate-->
				<materialViewer tableName = "video.t_mid_video_sdk_retentionrate_d" clear="false" partition="id,date">
					<hql>
					<![CDATA[
				      select projectid,platformid,activitychannelid,activityid,dtime,
							 if(newsubscriber=0,0,(day01againloginvisitor + day01againloginregister)/newsubscriber) day01retentionrate,
							 if(newsubscriber=0,0,(day03againloginvisitor + day03againloginregister)/newsubscriber) day03retentionrate,
							 if(newsubscriber=0,0,(day07againloginvisitor + day07againloginregister)/newsubscriber) day07retentionrate,
							 if(newsubscriber=0,0,(day15againloginvisitor + day15againloginregister)/newsubscriber) day15retentionrate,
							 if(newsubscriber=0,0,(day30againloginvisitor + day30againloginregister)/newsubscriber) day30retentionrate,
							 projectid id,dtime date
					    from (
						 select distinct projectid,activitychannelid,activityid,platformid,dtime,newsubscriber,day01againloginregister,day03againloginregister,
						        day07againloginregister,day15againloginregister,day30againloginregister,day01againloginvisitor,day03againloginvisitor,
								day07againloginvisitor,day15againloginvisitor,day30againloginvisitor
							from (
							 select projectid,activitychannelid,activityid,platformid,dtime,
									sum(novisitorconvert+newvisitor) over(partition by projectid,activitychannelid,activityid,dtime) newsubscriber,
									sum(day01againloginregister) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day01againloginregister,
									sum(day03againloginregister) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day03againloginregister,
									sum(day07againloginregister) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day07againloginregister,
									sum(day15againloginregister) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day15againloginregister,
									sum(day30againloginregister) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day30againloginregister,
									sum(day01againloginvisitor) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day01againloginvisitor,
									sum(day03againloginvisitor) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day03againloginvisitor,
									sum(day07againloginvisitor) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day07againloginvisitor,
									sum(day15againloginvisitor) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day15againloginvisitor,
									sum(day30againloginvisitor) over(partition by projectid,activitychannelid,activityid,platformid,dtime) day30againloginvisitor
							   from (
								select projectid,activitychannelid,activityid,platformid,dtime,
									   if(novisitorconvert is null,0,novisitorconvert) novisitorconvert ,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_novisitorconvert_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,if(newvisitor is null,0,newvisitor) newvisitor ,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_newvisitor_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								   
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   if(day01againloginregister is null,0,day01againloginregister) day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day01againloginregister_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,if(day03againloginregister is null,0,day03againloginregister) day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day03againloginregister_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,if(day07againloginregister is null,0,day07againloginregister) day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day07againloginregister_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,if(day15againloginregister is null,0,day15againloginregister) day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day15againloginregister_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,if(day30againloginregister is null,0,day30againloginregister) day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day30againloginregister_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								   
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   if(day01againloginvisitor is null,0,day01againloginvisitor) day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day01againloginvisitor_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,if(day03againloginvisitor is null,0,day03againloginvisitor) day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day03againloginvisitor_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,if(day07againloginvisitor is null,0,day07againloginvisitor) day07againloginvisitor,0 day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day07againloginvisitor_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,if(day15againloginvisitor is null,0,day15againloginvisitor) day15againloginvisitor,0 day30againloginvisitor
								  from video.t_mid_day15againloginvisitor_tmp 
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								 union all
								select projectid,activitychannelid,activityid,platformid,dtime,
									   0 novisitorconvert,0 newvisitor,
									   0 day01againloginregister,0 day03againloginregister,0 day07againloginregister,0 day15againloginregister,0 day30againloginregister,
									   0 day01againloginvisitor,0 day03againloginvisitor,0 day07againloginvisitor,0 day15againloginvisitor,if(day30againloginvisitor is null,0,day30againloginvisitor) day30againloginvisitor
								  from video.t_mid_day30againloginvisitor_tmp
								 where date > '{STARTTIME}'
								   and date < '{ENDTIME}'
								  )t
								   )tt
                                    )ttt								   
					]]>
					</hql>
				</materialViewer>
			</materialViewers>
        </report>
    </reports>
</reportSuite>
