{
"name": "角色定义",

"methods": [
    {
        "name":"/api/role/query",
        "type" : "RDB",
        
        "request" : {
            "parameters" : [
                {"name":"from", "type":"INT", "default":0, "min":0, "desc":"开始行号"},
                {"name":"perPage", "type":"INT", "default":100, "min":5, "max":100, "desc":"每页显示行数"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_roleQuery(?,?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "roles",
                    "multi" : true,
                    "segments" : [
                        {"name":"role", "type":"STR", "desc":"角色"},
                        {"name":"name", "type":"STR", "desc":"角色名称"},
                        {"name":"desc", "type":"STR", "desc":"角色描述"}
                    ]
                },
                {
                    "name" : "total",
                    "merge": true,
                    "segments" : [
                        {"name":"total", "type":"INT", "desc":"总数"}
                    ]
                }
            ]
        }
    },

    {
        "name":"/api/role/rightQuery",
        "type" : "AUTHRDB",
        "sql": "none",
        "writeLog":false,
        "dataType":"role",
        "operation":"r",
        
        "process" : {
            "processor":"com.huawei.manager.base.api.RoleRightQuery",
            "sql":"select 1"
        }
    },

    {
        "name":"/api/role/rightSave",
        "type" : "AUTHRDB",
        "dataType":"role",
        "operation":"u",
        
        "types":[
            {
                "name":"Operation",
                "segments":[
                    {"name":"name", "type":"STR", "must":true, "min":1, "max":20, "desc":"操作名称 c|r|u|d"},
                    {"name":"val", "type":"BOOL", "must":true, "desc":"是否具有权限"}
                ]
            },
            
            {
                "name":"Right",
                "segments":[
                    {"name":"dataType", "type":"STR", "must":true, "min":1, "max":25, "desc":"元数据类型"},
                    {"name":"operations", "type":"ARRAY", "must":true, "min":1, "max":20, "object":"Operation", "desc":"可执行的操作"}
                ]
            }
        ],
        
        "request" : {
            "parameters" : [
                {"name":"role", "type":"STR", "must":true, "min":1, "max":25, "desc":"角色名称"},
                {"name":"rights", "type":"ARRAY", "must":true, "object":"Right", "desc":"具有的权限"}
            ]
        },
        
        "process" : {
            "sql": "insert into t_ms_right(role, meta, oprRight) values(?,?,?)",
            "processor":"com.huawei.manager.base.api.RoleRightSave"
        }
    },

    {
        "name":"/api/role/create",
        "type" : "AUTHRDB",
        "dataType":"role",
        "operation":"c",
        "authType":"user",
        
        "request" : {
            "parameters": [
                {"name":"role", "type":"STRING", "must":true, "min":1, "max":20, "desc":"角色，唯一"},
                {"name":"name", "type":"STRING", "must":true, "min":1, "max":50, "desc":"角色名称"},
                {"name":"desc", "type":"STRING", "must":true, "default":"", "max":255, "desc":"角色描述"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_roleCreate(?, ?, ?, ?)}"
        }
    },
    
    {
        "name":"/api/role/modify",
        "type" : "AUTHRDB",
        "dataType":"role",
        "operation":"u",
        "authType":"user",
        
        "request" : {
            "parameters": [
                {"name":"role", "type":"STRING", "must":true, "min":1, "max":20, "desc":"角色，唯一"},
                {"name":"name", "type":"STRING", "must":true, "min":1, "max":50, "desc":"角色名称"},
                {"name":"desc", "type":"STRING","min":1, "max":255, "desc":"角色描述"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_roleModify(?, ?, ?, ?)}"
        }
    },
    
    {
        "name":"/api/role/detail",
        "type" : "AUTHRDB",
        "writeLog":false,
        "dataType":"role",
        "operation":"r",
        
        "request" : {
            "parameters": [
                {"name":"role", "type":"STRING", "must":true, "min":1, "max":32, "desc":"角色，唯一"}
            ]
        },
        
        "process" : {
            "sql" : "select role,name,description as 'desc' from t_ms_role where role=?"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "roles",
                    "merge" : true,
                    "segments" : [
                        {"name":"role", "type":"STR", "desc":"角色"},
                        {"name":"name", "type":"STR", "desc":"角色名称"},
                        {"name":"desc", "type":"STR", "desc":"角色描述"}
                    ]
                }
            ]
        }
    },

    {
        "name":"/api/role/remove",
        "type" : "AUTHRDB",
        "dataType":"role",
        "operation":"d",
            
        "request" : {
            "parameters": [
                {"name":"role", "type":"STRING", "must":true, "min":1, "max":32, "desc":"角色，唯一"}
            ]
        },
        
        "process" : {
            "transaction":true,
            "sql" : "{call sp_roleRemove(?,?)}"
        }
    }
]
}