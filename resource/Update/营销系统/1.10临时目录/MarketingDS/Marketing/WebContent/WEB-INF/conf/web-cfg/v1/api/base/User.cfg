{
"name": "用户管理",

"methods": [
    {
        "name":"/api/user/login",
        "type" : "RDB",
        "authType": "none",
        "writeLog" : true,
        "request" : {
            "parameters": [
                {"name":"account", "type":"STRING", "min":1, "max":32, "desc":"登录账号，系统中唯一"}
            ]
        },
        
        "process" : {
            "processor" : "com.huawei.manager.base.api.UserLogin",
            "sql" : "select exists(select * from t_ms_user where account = ?) as 'exists'"
        },
        
        "response" : {
            "results" : [
                    {
                        "name" : "result",
                        "merge" : true,
                        "segments" : [
                            {"name":"exists", "type":"BOOL", "desc":"登录账号，系统中唯一"}
                        ]
                    }
                ]
        }
    },
    
    {
        "name":"/api/user/logout",
        "type" : "JAVA",
        "authType": "none",
        "writeLog" : true,
        "process" : {
            "processor" : "com.huawei.manager.base.api.UserLogout"
        }
    },
    
    {
        "name":"/api/user/create",
        "type":"AUTHRDB",
        "authType": "user",
        "desc": "任何一个管理员都可以创建用户，但是用户初始无任何权限 ",
        "writeLog" : true,
        "dataType":"user",
        "operation":"c",
        
        "request" : {
            "parameters" : [
                {"name":"operator", "type":"ACCOUNT", "desc":"操作人账号"},
                {"name":"account", "type":"STRING", "must":true, "min":1, "max":40, "desc":"登录账号，系统中唯一"},
                {"name":"role", "type":"STRING", "must":true, "min":1, "max":40, "desc":"用户角色"},
                {"name":"phoneNum", "type":"STRING", "codeMode":"encode", "must":true, "min":1, "max":20, "regular":"\\d{0,4}[-]*\\d{7,11}$", "desc":"联系电话"},
                {"name":"email", "type":"STRING", "codeMode":"encode", "must":true, "min":1, "max":100, "regular":"[^@]+@[^@]+", "desc":"邮箱"},
                {"name":"name", "type":"STRING", "min":1, "max":20,"desc":"姓名"},
                {"name":"department", "type":"STRING","min":1, "max":50,  "desc":"部门"},
                {"name":"description", "type":"STRING", "desc":"用户描述"},
                {"name":"showFlag", "type":"INT", "desc":"联系人是否可查看"},
                {"name":"departmentType", "type":"INT", "desc":"部门归属"}
            ]
        },
        
        "process" : {
            "sql": "{call sp_userCreate(?,?,?,?,?,?,?,?,?,?,?)}"
        }
    },
    
    {
        "name":"/api/user/modify",
        "dataType":"user",
        "type": "AUTHRDB",
        "writeLog" : true,
        "operation":"u",

        "request" : {
            "parameters" : [
                {"name":"account", "type":"STR", "desc":"登录账号，系统中唯一"},
                {"name":"role", "type":"STR", "desc":"角色"},
                {"name":"phoneNum", "type":"STR", "codeMode":"encode", "min":7, "max":20, "regular":"\\d{0,4}[-]*\\d{7,11}$", "desc":"联系电话"},
                {"name":"email", "type":"STR", "codeMode":"encode", "min":5, "max":100, "regular":"[^@]+@[^@]+", "desc":"邮箱"},
                {"name":"name", "type":"STR", "min":1, "max":20, "desc":"姓名"},
                {"name":"department", "type":"STR","min":1, "max":50, "desc":"部门"},
                {"name":"description", "type":"STR", "desc":"描述"},
                {"name":"showFlag", "type":"INT", "desc":"是否可以展示"},
                {"name":"departmentType", "type":"INT", "desc":"是否可以展示"},
                {"name":"id", "type":"INT", "desc":"id"}
                
            ]
        },
        
        "process" : {
            "sql": "{call sp_userModify(?,?,?,?,?,?,?,?,?,?,?)}"
        }
    },
    
    {
        "name":"/api/user/self_modify",
        "type": "AUTHRDB",

        "request" : {
            "parameters" : [
                {"name":"account", "type":"ACCOUNT", "desc":"登录账号，系统中唯一"},
                {"name":"phoneNum", "type":"STR", "codeMode":"encode", "min":7, "max":20, "regular":"\\d{0,4}[-]*\\d{7,11}$", "desc":"联系电话"},
                {"name":"email", "type":"STR", "codeMode":"encode", "min":5, "max":100, "regular":"[^@]+@[^@]+", "desc":"邮箱"}
            ]
        },
        
        "process" : {
            "sql": "{call sp_userModify(?,?,?,?)}"
        }
    },
    
    {
        "name":"/api/user/remove",
        "authType": "user",
        "type": "AUTHRDB",
        "dataType":"user",
        "operation":"d",
        "writeLog" : true,

        "request" : {
            "parameters" : [
                {"name":"operator", "type":"ACCOUNT", "desc":"操作者账号，系统中唯一"},
                {"name":"account", "type":"STRING", "must":true, "min":1, "max":40, "desc":"登录账号，系统中唯一"}
            ]
        },
        
        "process" : {
            "transaction":true,
            "processor" : "com.huawei.manager.base.api.UserRemove",
            "sql": "{call sp_userRemove(?,?,?)}"
        }
    },
    
    {
        "name":"/api/user/changePassword",
        "authType":"once",
        "type": "AUTHRDB",
        "dataType":"user",
        "operation":"u",
        "writeLog" : true,

        "request" : {
            "parameters" : [
                {"name":"operator", "type":"ACCOUNT", "desc":"登录账号，系统中唯一"},
                {"name":"account", "type":"STRING", "min":5, "max":50, "strict":true, "desc":"登录账号，系统中唯一"},
                {"name":"oldPassword", "type":"PASSWORD", "partner":"account", "desc":"原密码", "log":false},
                {"name":"password", "type":"PASSWORD", "partner":"account", "verify":true, "desc":"新密码", "log":false},
                {"name":"confirmPassword", "type":"PASSWORD", "partner":"account", "equalsTo":"password", "desc":"重输入密码", "index":0, "log":false},
                {"name":"verify", "type":"STRING", "must":true, "min":2, "max":10, "desc":"验证码", "index":0, "retCode":7001},                
                {"name":"pwdValidDayNum", "type":"PWD_VALID_DAYNUM", "desc":"密码有效期天数"},
                {"name":"pwdDuplicateNum", "type":"PWD_DUPLICATE_NUM", "desc":"最大连续重复个数"}

            ]
        },
        
        "process" : {
        	"processor": "com.huawei.manager.base.api.UserChgPwd",
            "sql": "{call sp_changePassword(?,?,?,?,?,?,?)}"
        }
    },
    
    {
        "name":"/api/user/digest",
        "type" : "AUTHRDB",
        "authType": "user",
        "writeLog" : true,

        "request" : {
            "parameters" : [
                {"name":"account", "type":"STR", "min":1, "max":50, "desc":"登录账号，系统中唯一"}
            ]
        },
        
        "process" : {
            "sql" : "select a.account,a.role,a.createTime,a.phoneNum,a.email,a.name,a.department,a.description,a.showFlag,a.deptType as departmentType,a.id from t_ms_user a where a.account=? "
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "merge" : true,
                    "segments" : [
                        {"name":"account", "type":"STRING", "desc":"登录账号，系统中唯一"},
                        {"name":"role", "type":"STRING", "desc":"角色"},
                        {"name":"createTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"创建日期"},
                        {"name":"phoneNum", "type":"STRING", "codeMode":"decode", "desc":"联系电话"},
                        {"name":"email", "type":"STRING", "codeMode":"decode", "desc":"邮箱"},
                        {"name":"name", "type":"STRING", "desc":"姓名"},
                        {"name":"department", "type":"STRING","desc":"部门"},
                        {"name":"description", "type":"STRING","desc":"描述"},
                        {"name":"showFlag", "type":"INT", "desc":"是否展示"},
                        {"name":"departmentType", "type":"INT", "desc":"部门所属"},
                        {"name":"id", "type":"INT", "desc":"id"}
                    ]
                }
            ]
        }
    },
    
    {
        "name":"/api/user/query",
        "authType": "user",
        "type" : "AUTHRDB",
        "writeLog" : true,
        "dataType":"user",
        "operation":"r",
        
        "request" : {
            "parameters" : [
                {"name":"account", "type":"STRING", "min":1, "max":50, "desc":"账号，模糊查询"},
                {"name":"operator", "type":"ACCOUNT", "desc":"操作人账号"},
                {"name":"from", "type":"INT", "default":0, "min":0, "desc":"开始行号"},
                {"name":"perPage", "type":"INT", "default":10, "min":5, "max":100, "desc":"每页显示行数"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_userQuery(?,?,?,?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "multi" : true,
                    "segments" : [
                        {"name":"account", "type":"STRING", "desc":"登录账号，系统中唯一"},
                        {"name":"role", "type":"STRING", "desc":"角色"},
                        {"name":"createTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"创建日期"},
                        {"name":"phoneNum", "type":"STRING", "codeMode":"decode", "desc":"联系电话"},
                        {"name":"email", "type":"STRING", "codeMode":"decode", "desc":"邮箱"},
                        {"name":"creator", "type":"STRING", "desc":"创建人"},
                        {"name":"name", "type":"STRING", "desc":"描述"},
                        {"name":"department", "type":"STRING", "desc":"描述"},
                        {"name":"deptType", "type":"STRING", "desc":"部门归属"}
                    ]
                },
                
                {
                    "name" : "total",
                    "merge" : true,
                    "segments" : [
                        {"name":"total", "type":"INT", "desc":"总数"}
                    ]
                }
            ]
        }
    },
    
    
      {
        "name":"/api/user/getUserList",
        "authType": "user",
        "type" : "AUTHRDB",
        "writeLog":true,
        "dataType":"user",
        "operation":"r",
        
        "request" : {
        },
        
        "process" : {
            "processor": "com.huawei.manager.mkt.api.GetAddUserList",
            "sql" : "{call sp_userQueryNameList(?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "multi" : true,
                    "segments" : [
                        {"name":"userName", "type":"STRING", "desc":"登录账号，系统中唯一"}
                    ]
                }
            ]
        }
    },
    
    
    {
        "name":"/api/user/exists",
        "type" : "RDB",
        "authType": "none",
        "writeLog" : true,
        
        "request" : {
            "parameters" : [
                {"name":"account", "type":"STRING", "must":true, "min":1, "max":50, "desc":"用户账号"}
            ]
        },
        
        "process" : {
            "sql" : "select exists(select * from t_ms_user where account=?) as 'exists'"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "merge" : true,
                    "segments" : [
                        {"name":"exists", "type":"BOOL", "desc":"是否存在"}
                    ]
                }
            ]
        }
    },
    
    {
        "name":"/api/user/checkPassword",
        "type" : "JAVA",
        "authType": "none",
        
        "request" : {
            "parameters" : [
                {"name":"account", "type":"STR", "min":1, "max":20, "desc":"用户账号"},
                {"name":"password", "type":"PASSWORD", "partner":"account", "verify":true, "min":6, "max":20, "desc":"密码", "log":false, "retCode":4009}
            ]
        }
    },
    
    {
        "name":"/api/user/detail",
        "type" : "RDB",
        "authType": "user",
        "writeLog" : true,
        
        "request" : {
            "parameters" : [
                {"name":"account", "type":"ACCOUNT", "desc":"用户账号"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_userDetail(?, ?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "merge" : true,
                    "segments" : [
                        {"name":"account", "type":"STRING", "desc":"登录账号，系统中唯一"},
                        {"name":"createTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"创建日期"},
                        {"name":"phoneNum", "type":"STRING", "codeMode":"decode", "desc":"联系电话"},
                        {"name":"email", "type":"STRING", "codeMode":"decode", "desc":"邮箱"}
                    ]
                },
                
                {
                    "name" : "roles",
                    "multi" : true,
                    "segments" : [
                        {"name":"role", "type":"STRING", "desc":"角色"},
                        {"name":"path", "type":"STR", "desc":"所在位置"}
                    ]
                }
            ]
        }
    },
    
 	{
        "name":"/api/user/adminResetPassword",
        "type": "AUTHRDB",
        "dataType":"user",
        "operation":"u",
        "desc":"超级管理员直接充值密码，无须输入原密码",
        "writeLog" : true,

        "request" : {
            "parameters" : [
                {"name":"account", "type":"STRING", "must":true, "min":5, "max":40, "desc":"登录账号，系统中唯一"},
                {"name":"password", "index":0, "type":"STRING", "must":false, "desc":"密码", "log":false}
            ]
        },
        
        "process" : {
            "processor": "com.huawei.manager.base.api.AdminResetPwd",
            "sql": "{call sp_adminResetPwd(?,?,?)}"
        },
        
		"response" : {
            "results" : [
                {
                    "name" : "result",
                    "merge" : true,
                    "segments" : [
                        {"name":"password", "type":"STRING", "desc":"密码", "log":false}
                    ]
                }
            ]
        }
    },

 	{
        "name":"/api/user/adminUnlock",
        "type": "AUTHRDB",
        "dataType":"user",
        "operation":"u",
        "desc":"超级管理员手工解锁",
        "writeLog" : true,

        "request" : {
            "parameters" : [
                {"name":"account", "type":"STRING", "must":true, "min":5, "max":40, "desc":"登录账号，系统中唯一"}
            ]
        },
        
        "process" : {
            "sql": "{call sp_adminUnlock(?,?)}"
        }
    }
         
]
}