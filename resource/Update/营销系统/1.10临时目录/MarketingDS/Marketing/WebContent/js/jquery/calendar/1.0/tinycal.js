(function(e){var d=[31,28,31,30,31,30,31,31,30,31,30,31];var f=["日","一","二","三","四","五","六"];var m=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];var p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var o=["January","February","March","April","May","June","July","August","September","October","November","December"];var k=new Date();var g=function(s,t,r){t++;return r?(s+"-"+j(t)+"-"+j(r)):(s+"-"+j(t))};var l=function(s){var r=s.split("-");var t=new Date();t.setYear(parseInt(r[0]));t.setMonth(parseInt(r[1]));if(r[2]){t.setDate(parseInt(r[2]))}else{t.setDate(1)}return t};function j(r){if(r<10){return"0"+r}return r}e.addZero=j;var h=function(u,v){var r=[];for(var t in u){if(t>0){r.push(",")}r.push(u[t].year+"-"+j(u[t].month+1)+"-"+j(u[t].day))}var s=e(v);if(s.attr("type")){s.val(r.join(""))}else{s.html(r.join(""))}return true};var n={lang:"cn",weekDays:f,months:m,target:"",divName:"#_calendar_div",mode:"single",format:g,parse:l,ok:h,records:[],num:1,width:250,height:260};function a(r){return((r%4==0&&r%100!=0)||(r%400)==0)}function c(w,x,r,v){var u;for(var t=0,s=v.checked.length;t<s;t++){u=v.checked[t];if(u.year==w&&u.month==x&&u.day==r){return true}}return false}function b(w,x,r,v){var u;for(var t=0,s=v.checked.length;t<s;t++){u=v.checked[t];if(u.year==w&&u.month==x&&u.day==r){v.checked.splice(t,1);return}}}function i(t,r,s){return(t==k.getFullYear()&&r==k.getMonth()&&s==k.getDate())}var q={};e.fn.calendar=function(t){var s={checked:[]};e.extend(s,n);e.extend(s,t);if(s.lang=="cn"){s.weekDays=f;s.months=m}else{s.weekDays=p;s.months=o}if(e(s.divName).size()<=0){e("body").append('<div id="'+s.divName.substr(1)+'" class="calendar_body"/>')}if(s.records.length<s.num){for(var r=s.records.length;r<s.num;r++){s.records.push({year:k.getFullYear(),month:k.getMonth()})}}q[s.target]=s;e(s.target).click({target:s.target},function(w){var v=q[w.data.target];if(v){v.checked=[];u(v)}});function u(v){var G=v.target;var I=d[v.month];if(v.month==1){if(a(v.year)){I=29}}var z,I,H;var E=[];E.push('<div style="height:16px;text-align:right;">');if(v.mode=="multi"){E.push('<span class="calendar_opr ok"></span>')}E.push('<span class="calendar_opr close"></span></div>');for(var w=0;w<v.num;w++){z=v.records[w];I=d[z.month];if(v.month==1){if(a(z.year)){I=29}}H=new Date(z.year,z.month,1).getDay();E.push('<div style="float:left;width:',v.width,'px;">');E.push('<div style="margin:5px;">');E.push('<table class="calendar" style="border-radius:5px;border: 1px solid #AAAAAA;"><tr>','<td style="text-align:left;"><span class="calendar_btn foreYear" no="',w,'"></span>','&nbsp;<span class="calendar_btn foreMonth" no="',w,'"></span></td>','<td align="center">',v.format(z.year,z.month),'</td><td style="text-align:right;"><span class="calendar_btn nextMonth" no="',w,'"></span>','&nbsp;<span class="calendar_btn nextYear" no="',w,'"></span></td>',"</tr></table>");E.push('<table class="calendar"><tr>');for(var C=0;C<7;C++){E.push("<th>",v.weekDays[C],"</th>")}E.push("</tr>");var K=1;for(var C=0;C<6&&K<=I;C++){E.push("<tr>");for(var B=0;B<7;B++){E.push("<td");if(K<=I&&(C>0||B>=H)){if(i(z.year,z.month,K)){E.push(' class="today"')}E.push(' align="center" valign="middle">');if(c(z.year,z.month,K,v)){E.push('<div class="calendar_day selectedDay"')}else{E.push('<div class="calendar_day day"')}E.push(' day="',K,'" no="',w,'">',K,"</div>");K++}else{E.push(">")}E.push("</td>")}E.push("</tr>")}E.push("</table>");E.push("</div>");E.push("</div>")}var M=e(v.divName);M.html(E.join(""));M.width(v.num*v.width);var F=e(G);var A=F.offset();var L=A.left;var J=A.top;var D=F.height();M.css({top:(J+D+6),left:L,"z-index":1000,height:v.height+"px",width:(v.width*v.num)+"px",});M.fadeIn();e("span.calendar_btn.foreYear").click({target:G},function(y){var N=parseInt(e(this).attr("no"));var x=q[y.data.target];if(x.records[N].year>1900){x.records[N].year--;u(x)}});e("span.calendar_btn.foreMonth").click({target:G},function(y){var N=parseInt(e(this).attr("no"));var x=q[y.data.target];if(x.records[N].month>0){x.records[N].month--;u(x)}else{if(x.records[N].year>1900){x.records[N].month=11;x.records[N].year--;u(x)}}});e("span.calendar_btn.nextYear").click({target:G},function(y){var N=parseInt(e(this).attr("no"));var x=q[y.data.target];if(x.records[N].year<2200){x.records[N].year++;u(x)}});e("span.calendar_btn.nextMonth").click({target:G},function(y){var x=q[y.data.target];var N=parseInt(e(this).attr("no"));if(x.records[N].month<11){x.records[N].month++;u(x)}else{if(x.records[N].year<2200){x.records[N].year++;x.records[N].month=0;u(x)}}});e("div.calendar_day.day").click({target:G},function(x){var T=e(this).attr("day");if(!T){return}T=parseInt(T);var P=parseInt(e(this).attr("no"));var S=x.data.target;var y=q[S];var R={year:y.records[P].year,month:y.records[P].month,day:T};if(y.mode=="single"){if(y.ok([R],S)){e(y.divName).fadeOut()}}else{if(y.mode=="multi"){y.checked.push(R);u(y)}else{y.checked.push(R);if(y.checked.length>1){var N=y.checked[0];var Q=new Date(N.year,N.month,N.day);var N=y.checked[1];var O=new Date(N.year,N.month,N.day);if(Q.getTime()>O.getTime()){y.checked[0]={year:O.getFullYear(),month:O.getMonth(),day:O.getDate()};y.checked[1]={year:Q.getFullYear(),month:Q.getMonth(),day:Q.getDate()}}if(y.ok(y.checked,S)){e(y.divName).fadeOut()}}else{u(y)}}}});e("div.calendar_day.selectedDay").click({target:G},function(N){var x=e(this).attr("day");if(!x){return}var O=N.data.target;var y=q[O];var P=parseInt(e(this).attr("no"));b(y.records[P].year,y.records[P].month,x,y);u(y)});e("span.calendar_opr.close").click({target:G},function(y){var N=y.data.target;var x=q[N];e(x.divName).fadeOut()});e("span.calendar_opr.ok").click({target:G},function(y){var N=y.data.target;var x=q[N];x.ok(x.checked,N);e(x.divName).fadeOut()})}}})(jQuery);