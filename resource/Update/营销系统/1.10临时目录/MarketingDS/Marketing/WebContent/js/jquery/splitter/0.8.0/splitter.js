/*!
 * JQuery Spliter Plugin
 * Copyright (C) 2010-2013 Jakub Jankiewicz <http://jcubic.pl> 
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
(function(e,f){var b=0;var d=null;var a=[];var c=null;e.fn.split=function(u){var l=this.data("splitter");if(l){return l}var p;var o;var k=e.extend({limit:100,orientation:"horizontal",position:"50%",onDragStart:e.noop,onDragEnd:e.noop,onDrag:e.noop},u||{});var t;var j=this.children();if(k.orientation=="vertical"){p=j.first().addClass("left_panel");o=p.next().addClass("right_panel");t="vsplitter"}else{if(k.orientation=="horizontal"){p=j.first().addClass("top_panel");o=p.next().addClass("bottom_panel");t="hsplitter"}}var i=this.width();var q=this.height();var h=b++;this.addClass("splitter_panel");var g=e("<div/>").addClass(t).mouseenter(function(){d=h}).mouseleave(function(){d=null}).insertAfter(p);var m;function s(v){if(typeof v==="number"){return v}else{if(typeof v==="string"){var w=v.match(/^([0-9]+)(px|%)$/);if(w){if(w[2]=="px"){return +w[1]}else{if(k.orientation=="vertical"){return(i*+w[1])/100}else{if(k.orientation=="horizontal"){return(q*+w[1])/100}}}}else{}}else{}}}var r=e.extend(this,{refresh:function(){var v=this.width();var w=this.height();if(i!=v||q!=w){i=this.width();q=this.height();r.position(m)}},position:(function(){if(k.orientation=="vertical"){return function(x,w){if(x===f){return m}else{m=s(x);var v=g.width()/2;g.css("left",m-v);p.width(m-v);o.width(r.width()-m-v)}if(!w){r.find(".splitter_panel").trigger("splitter.resize")}return r}}else{if(k.orientation=="horizontal"){return function(x,w){if(x===f){return m}else{m=s(x);var v=g.height()/2;g.css("top",m-v);p.height(m-v);o.height(r.height()-m-v)}if(!w){r.find(".splitter_panel").trigger("splitter.resize")}return r}}else{return e.noop}}})(),orientation:k.orientation,limit:k.limit,isActive:function(){return d===h},destroy:function(){r.removeClass("splitter_panel");g.unbind("mouseenter");g.unbind("mouseleave");if(k.orientation=="vertical"){p.removeClass("left_panel");o.removeClass("right_panel")}else{if(k.orientation=="horizontal"){p.removeClass("top_panel");o.removeClass("bottom_panel")}}r.unbind("splitter.resize");r.find(".splitter_panel").trigger("splitter.resize");a[h]=null;g.remove();var w=false;for(var v=a.length;v--;){if(a[v]!==null){w=true;break}}if(!w){e(document.documentElement).unbind(".splitter");e(window).unbind("resize.splitter");a=[]}}});r.bind("splitter.resize",function(v){var w=r.position();if(r.orientation=="vertical"&&w>r.width()){w=r.width()-r.limit-1}else{if(r.orientation=="horizontal"&&w>r.height()){w=r.height()-r.limit-1}}if(w<r.limit){w=r.limit+1}r.position(w,true)});var n;if(k.orientation=="vertical"){if(n>i-k.limit){n=i-k.limit}else{n=s(k.position)}}else{if(k.orientation=="horizontal"){if(n>q-k.limit){n=q-k.limit}else{n=s(k.position)}}}if(n<k.limit){n=k.limit}r.position(n,true);if(a.length==0){e(window).bind("resize.splitter",function(){e.each(a,function(v,w){w.refresh()})});e(document.documentElement).bind("mousedown.splitter",function(v){if(d!==null){c=a[d];e('<div class="splitterMask"></div>').insertAfter(c);if(c.orientation=="horizontal"){e("body").css("cursor","row-resize")}else{if(c.orientation=="vertical"){e("body").css("cursor","col-resize")}}k.onDragStart(v);return false}}).bind("mouseup.splitter",function(v){e(".splitterMask").remove();c=null;e("body").css("cursor","auto");k.onDragEnd(v)}).bind("mousemove.splitter",function(z){if(c!==null){var w=c.limit;var A=c.offset();if(c.orientation=="vertical"){var v=z.pageX-A.left;if(v<=c.limit){v=c.limit+1}else{if(v>=c.width()-w){v=c.width()-w-1}}if(v>c.limit&&v<c.width()-w){c.position(v,true);c.find(".splitter_panel").trigger("splitter.resize");return false}}else{if(c.orientation=="horizontal"){var B=z.pageY-A.top;if(B<=c.limit){B=c.limit+1}else{if(B>=c.height()-w){B=c.height()-w-1}}if(B>c.limit&&B<c.height()-w){c.position(B,true);c.trigger("splitter.resize");return false}}}k.onDrag(z)}})}a.push(r);r.data("splitter",r);return r}})(jQuery);