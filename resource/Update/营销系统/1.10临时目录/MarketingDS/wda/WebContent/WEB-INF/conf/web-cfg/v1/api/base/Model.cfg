{
"name": "系统模型管理",

"methods": [
    {
        "type" : "AUTHRDB",
        "name":"/api/model/getIdByPath",
        
        "request" : {
            "parameters": [
                {"name":"path", "type":"STRING", "must":true, "min":1, "max":255, "desc":"模型路径"}
            ]
        },
        
        "process" : {
        	"ehcache":"rightCache",
            "sql" : "{call sp_modelGetIdByPath(?,?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "id",
                    "segments" : [
                        {"name":"id", "type":"INT", "desc":"模型ID"}
                    ]
                }
            ]           
        }
    },
    
    {
        "name":"/api/model/getPathById",
        "type" : "AUTHRDB",
        
        "request" : {
            "parameters": [
                {"name":"id", "type":"INT", "must":true, "min":1, "desc":"模型ID"}
            ]
        },
        
        "process" : {
        	"ehcache":"rightCache",
            "sql" : "{call sp_modelGetPathById(?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "path",
                    "segments" : [
                        {"name":"path", "type":"STRING", "desc":"模块路径"}
                    ]
                }
            ]           
        }
    },
    
    {
        "name":"/api/model/create",
        "authType" : "user",
        "type" : "AUTHRDB",
        "dataType":"model",
        "operation":"c",
        
        "request" : {
            "parameters" : [
                {"name":"account", "type":"ACCOUNT", "desc":"账号"},
                {"name":"pid", "type":"INT", "must":true, "min":1, "desc":"父模型ID"},
                {"name":"name", "type":"STR", "must":true, "min":1, "max":255, "desc":"模型名称"},
                {"name":"type", "type":"STR", "must":true, "min":1, "max":15, "desc":"模型节点的类型"},
                {"name":"val", "type":"STR", "default":"", "max":255, "desc":"描述"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_modelCreate(?,?,?,?,?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "merge" : true,
                    "segments" : [
                        {"name":"id", "type":"INT", "must":true, "desc":"模型id"}
                    ]
                }
            ]
        }
    },
    
    {
        "name":"/api/model/modify",
        "authType" : "user",
        "type" : "AUTHRDB",
        "dataType":"model",
        "operation":"u",
        
        "request" : {
            "parameters" : [
                {"name":"id", "type":"INT", "must":true, "desc":"父模型ID"},
                {"name":"pid", "type":"INT", "must":false, "desc":"父模型ID"},
                {"name":"name", "type":"STR", "must":false, "max":255, "desc":"模型名称"},
                {"name":"val", "type":"STR", "must":false, "max":255, "desc":"模型节点的值"}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_modelModify(?,?,?,?,?)}"
        }
    },
    
    {
        "name":"/api/model/remove",
        "authType" : "user",
        "type" : "AUTHRDB",
        "dataType":"model",
        "operation":"d",
        
        "request" : {
            "parameters" : [
                {"name":"id", "type":"INT", "must":true, "desc":"数据ID"},
                {"name":"pid", "type":"INT", "must":true, "desc":"模型/菜单ID", "index":0}
            ]
        },
        
        "process" : {
            "sql" : "{call sp_modelRemove(?,?)}"
        }
    },
    
    {
        "name":"/api/model/detail",
        "authType" : "user",
        "type" : "AUTHRDB",
        "dataType":"model",
        "operation":"r",
        
        "request" : {
            "parameters" : [
                {"name":"id", "type":"INT", "must":true, "desc":"模型ID"}
            ]
        },
        
        "process" : {
            "sql" : "select pid,meta,name,val,createTime,modifyTime from t_ms_model where id=?"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "result",
                    "merge" : true,
                    "segments" : [
                        {"name":"pid", "type":"INT", "desc":"父模型ID"},
                        {"name":"meta", "type":"STR", "desc":"模型类型"},
                        {"name":"name", "type":"STR", "desc":"模型名称"},
                        {"name":"val", "type":"STR", "desc":"模型节点的值"},
                        {"name":"createTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"创建时间"},
                        {"name":"modifyTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"修改时间"}
                    ]
                }
            ]
        }
    },
    
    {
        "name":"/api/model/querySub",
        "authType" : "user",
        "type" : "AUTHRDB",
        "dataType":"model",
        "operation":"r",
        "writeLog":false,
        
        "request" : {
            "parameters" : [
                {"name":"account", "type":"ACCOUNT", "desc":"账号"},
                {"name":"id", "type":"INT", "must":true, "desc":"父模型ID"},
                {"name":"meta", "type":"STR", "desc":"要查询的类型"},
                {"name":"visible", "type":"BOOL", "desc":"是否可见，为空时，都返回"},
                {"name":"from", "type":"INT","default":0, "min":0, "desc":"开始行号"},
                {"name":"perPage", "type":"INT", "default":10, "min":5, "max":100, "desc":"每页显示行数"},
                {"name":"segments", "type":"ARRAY", "default":["id","meta","name"], "separator":",",
                 "object":{"name":"column", "type":"STR", "min":1, "max":50}, "desc":"字段"}
            ]
        },
        
        "process" : {
            "scopePara":"id",
            "sql" : "{call sp_modelQuery(?,?,?,?,?,?,?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "models",
                    "multi" : true,
                    "segments" : [
                        {"name":"id", "type":"INT", "desc":"父模型ID"},
                        {"name":"meta", "type":"STR", "desc":"元模型"},
                        {"name":"name", "type":"STR", "desc":"模型名称"},
                        {"name":"createTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"创建日期"},
                        {"name":"creator", "type":"STR", "desc":"创建人"},
                        {"name":"val", "type":"STR", "desc":"模型节点的值"}
                    ]
                },
                {
                    "name" : "total",
                    "merge" : true,
                    "segments" : [
                        {"name":"total", "type":"INT", "desc":"总数"}
                    ]
                }
            ]
        }
    },
    
    {
        "name":"/api/model/queryAdmin",
        "authType" : "user",
        "type" : "AUTHRDB",
        "dataType":"admin",
        "operation":"r",
        "writeLog":false,
        
        "request" : {
            "parameters" : [
                {"name":"id", "type":"INT", "must":true, "desc":"父模型ID"},
                {"name":"from", "type":"INT","default":0, "min":0, "desc":"开始行号"},
                {"name":"perPage", "type":"INT", "default":10, "min":5, "max":100, "desc":"每页显示行数"}
            ]
        },
        
        "process" : {
            "scopePara":"id",
            "sql" : "{call sp_adminQuery(?,?,?,?)}"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "models",
                    "multi" : true,
                    "segments" : [
                        {"name":"id", "type":"INT", "desc":"父模型ID"},
                        {"name":"name", "type":"STR", "desc":"账号"},
                        {"name":"createTime", "type":"DATE", "format":"yyyy-MM-dd HH:mm:ss", "desc":"创建日期"},
                        {"name":"creator", "type":"STR", "desc":"创建人"},
                        {"name":"role", "type":"STR", "desc":"角色"}
                    ]
                },
                {
                    "name" : "total",
                    "merge" : true,
                    "segments" : [
                        {"name":"total", "type":"INT", "desc":"总数"}
                    ]
                }
            ]
        }
    },
	
    {
        "name":"/api/meta/query",
        "authType" : "none",
        "type" : "AUTHRDB",
        
        "request" : {
            "parameters" : [
                {"name":"name", "type":"STR", "must":false, "min":1, "max":15, "desc":"元模型名称"}
            ]
        },
        
        "process" : {
            "ehcache":"rightCache",
            "useOldWhenFailed":true,
            "sql" : "select name, isVisible, isUnique, url, description as 'desc', subMetas,icon from t_ms_meta where name=ifnull(?, name)"
        },
        
        "response" : {
            "results" : [
                {
                    "name" : "metas",
                    "multi" : true,
                    "segments" : [
                        {"name":"name", "type":"STR", "desc":"元模型名称"},
                        {"name":"isVisible", "type":"BOOL", "desc":"是否可见"},
                        {"name":"isUnique", "type":"BOOL", "desc":"同级模型下，是否唯一"},
                        {"name":"url", "type":"STR", "desc":"系统中的操作页面，未带webRoot"},
                        {"name":"desc", "type":"STR", "desc":"描述"},
                        {"name":"icon", "type":"STR", "desc":"树图中的图标"},
                        {"name":"subMetas", "type":"STR", "desc":"子元模型"}
                    ]
                }
            ]
        }
    }
]
}